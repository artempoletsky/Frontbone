/*! frontbone 2014-03-21 */
(function(t){"use strict";var e,n,i,r=[],s=!1,o=!1,a=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.msRequestAnimationFrame||t.oRequestAnimationFrame||function(t){setTimeout(function(){t()},1e3/15)};t.ComputedRefresher={refreshAll:function(){_.each(r,function(t){t.notify()}),r=[]},startRefresh:function(){var t=this;s=!0,a(function(){s&&(t.refreshAll(),t.startRefresh())})},stopRefresh:function(){s=!1}};var u=t.ObjectObservable=function(t){t=t||{},this.dependencies=[],this.selfCallbacks=[],this.listeners=[];var n=t.initial,i=t.$el;if(t.evil){var r=ViewModel.evil(t.evil.string,t.evil.context,t.evil.addArgs);o=this;var s=r();e.isObservable(s)?(n=s(),this.getter=function(){return s()},this.setter=function(t){return s(t),t}):(n=s,this.getter=function(){return r()}),o=!1}else t.get&&(o=this,n=t.get(),o=!1,this.getter=t.get);if(i){var a=i.data("nk_observers");a=a||[],a.push(this),i.data("nk_observers",a)}t.set&&(this.setter=t.set),this.lastValue=this.value=n,this.dirty=t.dirty};u.prototype={setter:function(t){return t},getter:function(){return o&&o.dependsOn(this),this.value},set:function(t){return this.value=this.setter(t),this.notify()},get:function(){return this.getter()},destroy:function(){var t=this;_.each(t.dependencies,function(e,n){e.unsubscribe(t.selfCallbacks[n])}),t.dependencies=void 0,t.selfCallbacks=void 0,t.listeners=[],t.value=void 0,t.lastValue=void 0},dependsOn:function(t){var e=this;if(-1===e.dependencies.indexOf(t)){e.dependencies.push(t);var n=function(){e.notify()};e.selfCallbacks.push(n),t.subscribe(n)}return e},subscribe:function(t){return this.listeners.push(t),this},unsubscribe:function(t){return this.listeners=_.filter(this.listeners,function(e){return e!==t}),this},notify:function(){var t=this,e=t.get();return t.lastValue!==e&&_.each(t.listeners,function(t){t(e)}),t.lastValue=e,t},fire:function(){var t=this,e=t.get();return _.each(t.listeners,function(t){t(e)}),t},callAndSubscribe:function(t){return t(this.get()),this.subscribe(t)},valueOf:function(){return this.get()},toString:function(){return this.get()}},i=function(t){var e=new u(t),n=function(t){return 0!==arguments.length?(e.set(t),t):e.get()};return _.extend(n,{obj:e,subscribe:function(t){return e.subscribe(t),this},unsubscribe:function(t){return e.unsubscribe(t),this},fire:function(){return e.fire(),this},_notSimple:!0,__observable:!0}),n.valueOf=n.toString=function(){return n()},n},e=function(t){return i({initial:t})},e.isObservable=function(t){return"function"!=typeof t?!1:t.__observable||!1},n=function(t,e){if(e)throw Error("Context for computed is obsolete");return i("function"==typeof t?{get:t}:t)},t.Observable=e,t.Computed=n})(this),function(t){"use strict";var e=function(){},n=function(){},i=/xyz/.test(function(){alert("xyz")})?/\b_super\b/:/.*/;n.prototype._constructor=Object,n.prototype.constructor=n,n.extend=function(t){"function"==typeof t&&(t={constructor:t});var n=this,r=function(){this._constructor.apply(this,arguments)};return t.hasOwnProperty("constructor")&&(t._constructor=t.constructor),e.prototype=n.prototype,r.prototype=new e,_.forOwn(t,function(t,e){r.prototype[e]="function"==typeof t&&void 0===t._notSimple&&i.test(""+t)?function(){var i,r=this._super;return this._super=n.prototype[e],i=t.apply(this,arguments),this._super=r,i}:t}),r.prototype.constructor=r,r._notSimple=!0,r.extend=n.extend,r.create=n.create,r},n.create=function(t){var e,n,i,r=_.toArray(arguments),s=this.extend(t),o="return new child(",a=["child"],u=[s];if(r.shift(),e=r.length,e>0){for(n=0;e>n;n++)o+="arg"+n+", ",a.push("arg"+n),u.push(r[n]);o=o.substr(0,o.length-2)}o+=");",a.push(o);try{i=Function.apply(void 0,a).apply(void 0,u)}catch(c){throw c}return i},t.Class=n}(this),function(t){"use strict";Array.prototype.indexOf||(Array.prototype.indexOf=function(t,e){return _.indexOf(this,t,e)});var e=/\s+/,n=".",i=function(t,e,i,r){t+="";var s=t.split(n);return{c:i,s:r,fn:e,n:s[0],ns:s.slice(1),o:t}},r=function(t,e){var n,i;n=t._listeners||{},i=n[e.n]||[],i.push(e),n[e.n]=i,t._listeners=n},s=function(t,e,n,r,s){var o,a,u,c,h,l,f,d="any"===s?!1:[],p=i(e,n,r);s||(s="filter");for(o in t){for(a=t[o],c=0,u=a.length;u>c;c++)if(h=a[c],l=!(p.fn&&p.fn!==h.fn||p.n&&p.n!==h.n||p.c&&p.c!==h.c),l&&p.ns.length&&(f=h.ns,l=!_.any(p.ns,function(t){return f.indexOf(t)})),l){if("filter"===s)d.push(h);else if("any"===s){d=!0;break}}else"invert"===s&&d.push(h);if(d===!0)break}return d},o=function(t,e,n,o){var a,u,c;if(t._listeners){if(!e&&!n&&!o)return delete t._listeners,void 0;if(a=i(e,n,o),!a.ns.length&&!n&&!o)return delete t._listeners[a.n],void 0;for(u=s(t._listeners,e,n,o,"invert"),delete t._listeners,c=u.length-1;c>=0;c--)r(t,u[c])}},a=Class.extend({on:function(t,n,s,o){var a,u,c,h,l,f=this;if(_.isObject(t)){a=n||f;for(l in t)f.on(l,t[l],a,o);return this}if("function"!=typeof n)throw TypeError("function expected");for(s||(s=this),u=t.split(e),c=0,h=u.length;h>c;c++)r(f,i(u[c],n,s,o));return f},off:function(t,n,i){var r,s,a,u=this;if(!t)return o(u,"",n,i),u;for(a=t.split(e),r=0,s=a.length;s>r;r++)o(u,a[r],n,i);return u},fire:function(t){if(!this._listeners)return this;var n,i,r,o,a,u,c,h=_.rest(arguments,1),l=this;for(r=t.split(e),n=0,i=r.length;i>n;n++)for(o=s(l._listeners,r[n],!1,!1),a=0,u=o.length;u>a;a++)c=o[a],c.s&&l.off(0,c.fn),c.fn.apply(c.c,h);return l},one:function(t,e,n){return this.on(t,e,n,!0)},hasListener:function(t){return this._listeners?s(this._listeners,t,!1,!1,"any"):!1}});a.prototype.trigger=a.prototype.fire,t.Events=a}(this),function(t){"use strict";var e={},n=Events.extend({constructor:function(t){t=t||{},this.attributes=_.extend({},this.defaults,this.parse(t)),this._changed={},this.id=this.attributes[this.idAttribute],this.cid=_.uniqueId("c"),this.mapping&&this.id&&(e[this.mapping]=e[this.mapping]||{},e[this.mapping][this.id]=this),this.initialize()},initialize:function(){return this},idAttribute:"id",mapping:!1,defaults:{},toJSON:function(){return _.clone(this.attributes)},parse:function(t){return t},baseURL:"/",url:function(){return this.baseURL+(this.mapping?this.mapping+"/":"")+(this.id?this.id+"/":"")},update:function(t){return this.prop(this.parse(t)),this._changed={},this},prop:function(t,e){if(1===arguments.length&&"string"==typeof t)return this.attributes[t];var n={},i=this,r={};return"string"==typeof t?n[t]=e:n=t,_.each(n,function(t,e){r[e]=i._changed[e]=i.attributes[e]=t,e===i.idAttribute&&(i.id=t),i.fire("change:"+e)}),this.fire("change",r),this},get:function(){return this.prop.apply(this,arguments)},set:function(){return this.prop.apply(this,arguments)},validate:function(){return!1},fetch:function(t){t=t||{};var e=this,i={success:function(n){e.update(n),"function"==typeof t.success&&t.success.apply(e,arguments)},error:function(){"function"==typeof t.error&&t.error.apply(e,arguments)}};return n.sync("get",this.url(),_.extend({},t,i)),this},save:function(t){var e,i=this,r=this.validate(t);if(r)return this.trigger("invalid",this,r),void 0;if(e=_.isFunction(this.url)?this.url():this.url,t&&this.prop(t),this.id){if(0===_.keys(i._changed).length)return this;n.sync("update",e,{data:i._changed,success:function(t){i.update(t)}})}else n.sync("create",e,{data:_.clone(this.attributes),success:function(t){i.update(t)}});return this},remove:function(){this.fire("remove"),this.id&&n.sync("delete",this.url(),{})}});n.fromStorage=function(t,n){return e[t]=e[t]||{},e[t][n]},n.createOrUpdate=function(t,e){var i,r,s,o=t.prototype;return o.mapping&&(r=o.idAttribute,s=o.parse(e),i=n.fromStorage(o.mapping,s[r]))?(i.update(e),i):new t(e)},n.sync=function(t,e,n){n=n||{};var i={method:t};"PUT"===t&&(t="POST"),$.extend(i,n.data),$.ajax({url:e,dataType:"json",type:t,data:i,success:n.success,error:n.error})},t.Model=n}(this),function(t){"use strict";var e=function(t){this.self=t},n=Model.extend({constructor:function(t,n){this.attributes={},this._changed={},this.itself=new e(this),this.models=[],this.length=0,this._hashId=[],t&&this.reset(t),this.initialize(n)},models:[],model:Model,url:function(){return this.baseURL+this.model.prototype.mapping+"/"},fetch:function(t){t=t||{};var e=this,n={success:function(n){e.reset(n,t),"function"==typeof t.success&&t.success.apply(e,arguments)},error:function(){"function"==typeof t.error&&t.error.apply(e,arguments)}},i=_.extend({},t,n);Model.sync("GET",this.url(),i)},reset:function(t,e){if(e=e||{},e.add||(this.fire("beforeReset",this.models),this.models=[],this.length=0,this._hashId=[]),!t)return this.fire("reset"),this;var n=this.parse(t);return this.add(n,"end",!e.add),e.add||this.fire("reset"),this},push:function(t){return this.add(t)},unshift:function(t){return this.add(t,0)},add:function(t,e,n){function i(t,e){if(0===e&&o.length)r=o._hashId[0].index-1,o._hashId.unshift({id:t.id,index:r});else{var n=o._hashId.length;r=0===n?1:o._hashId[n-1].index+1,o._hashId.push({id:t.id,index:r})}}var r,s,o=this,a=[],u=0;return t instanceof Array||(t=[t]),"number"!=typeof e?(e=this.length,u=this.getIndex(this.models[this.length-1])):0===e&&(s=_.clone(t).reverse(),u=this.getIndex(this.models[0])-s.length-1),_.each(t,function(t,n){t instanceof Model||(t=Model.createOrUpdate(o.model,t)),a.push(t),s?i(s[n],0):i(t,e+n),t.one("remove",function(){o.cutByCid(this.cid)}),o.models.splice(e+n,0,t)}),this.length=this.models.length,n||this.fire("add",a,e,u),this},cut:function(t){var e,n=this;return this.each(function(i,r){return i.id===t?(e=n.cutAt(r),!1):void 0}),e},cutByCid:function(t){var e,n=this;return this.each(function(i,r){return i.cid===t?(e=n.cutAt(r),!1):void 0}),e},shift:function(){return this.cutAt(0)},pop:function(){return this.cutAt()},cutAt:function(t){void 0===t&&(t=this.models.length-1);var e,n=this.models.splice(t,1)[0];return this._hashId.splice(t,1),this.length=this.models.length,e={},e[t]=n,this.fire("cut",e),n},at:function(t){return this.models[t]},get:function(){return this.getByID.apply(this,arguments)},getByID:function(t){var e;return this.each(function(n){return n.id==t?(e=n,!1):void 0}),e},getByCid:function(t){var e;return this.each(function(n){return n.cid==t?(e=n,!1):void 0}),e},getIndex:function(t){if(!t)return 0;var e=this.indexOf(t);return this._hashId[e].index}}),i=["detect","filter","select","reject","find","every","all","some","any","max","min","sortBy","sortByDesc","first","initial","rest","last","groupBy"],r=["forEach","each","map","reduce","reduceRight","foldl","foldr","include","contains","invoke","sortedIndex","toArray","size","without","indexOf","shuffle","lastIndexOf","isEmpty"],s=["filter","reject"],o=["sortBy","sortByDesc","shuffle"];_.mixin({sortByDesc:function(t,e,n){return this.sortBy(t,e,n).reverse()}});var a=function(t){return function(e){var n=!0;return _.forIn(t,function(t,i){return t!==e.attributes[i]?(n=!1,!1):void 0}),n}},u=function(t){return function(e){return e.attributes[t]}};_.each(r,function(t){n.prototype[t]=function(){return _[t].apply(_,[this.models].concat(_.toArray(arguments)))}}),_.each(i,function(t){n.prototype[t]=function(e,n){if("function"==typeof e)return _[t].apply(_,[this.models].concat(_.toArray(arguments)));var i;if("string"==typeof e){if(2!=arguments.length)return _[t](this.models,u(e));i={},i[e]=n}return i||(i=e),_[t](this.models,a(i))}}),_.each(s,function(t){e.prototype[t]=function(){var e="filter"===t?"reject":"filter",n=this.self,i=(_.toArray(arguments),n[t].apply(n,arguments)),r=n[e].apply(n,arguments),s={};return _.each(r,function(t){s[n.indexOf(t)]=t}),n.models=i,n.length=i.length,n.fire("cut",s),n}}),_.each(o,function(t){e.prototype[t]=function(){var e=this.self,n=e[t].apply(e,arguments),i={};return _.each(n,function(t,n){i[e.indexOf(t)]=n}),e.models=n,e.length=n.length,e.fire("sort",i),e}}),t.Collection=n}(this),function(t){"use strict";var e,n=t.$,i=/\s+/,r=/^[a-z]+$/,s=/^\s*([^:]+)\s*:\s*([\s\S]*\S)\s*$/,o=/\s*,\s*/,a={setElement:function(t){return this.undelegateEvents(),this.el=t,this.$el=n(t),this.parse().delegateEvents(),this},constructor:function(t){t=t||{},this.options=t,t.collection&&(this.collection=t.collection),this.model=t.model,t.el&&(this.el=t.el);var e=this;e._cid||(e._cid=_.uniqueId("vm")),e.el||(e.el="div"),"string"==typeof e.el&&(e.el=r.test(e.el)&&"html"!==e.el&&"body"!==e.el?document.createElement(e.el):n(e.el)[0]),e.$el=n(e.el),e.$=function(t){return e.$el.find(t)},e.initialize(),e.autoParseBinds&&e.parse(),e.delegateEvents()},remove:function(){return this.$el.remove(),this},parse:function(){return a.findBinds(this.el,this),this},autoParseBinds:!1,initialize:function(){},delegateEvents:function(t){t=t||this.events,this.undelegateEvents();var e,n,r=this;return _.each(t,function(t,s){var o,a="function"==typeof t?t:r[t];if("function"!=typeof a)throw TypeError(t+" is not a function");e=s.split(i),n=e.shift().split(",").join("."+r._cid+" ")+"."+r._cid,o=_.bind(a,r),e.length?r.$el.delegate(e.join(" "),n,o):r.$el.bind(n,o)}),this},undelegateEvents:function(){return this.$el.unbind("."+this._cid),this},render:function(){return this}};a=Events.extend(a),n.fn.clearBinds=function(){var t=n();return t.length=1,this.each(function(){t[0]=this,_.each(t.data("nk_observers"),function(t){t.destroy()}),t.data("nk_observers",[]),t.children().clearBinds()}),this},n.fn.refreshBinds=function(){var t=n();return t.length=1,this.each(function(){t[0]=this,_.each(t.data("nk_observers"),function(t){t.notify()}),t.children().refreshBinds()}),this},a.evil=function(t,e,n,i){if(n=n||{},"string"!=typeof t)throw new TypeError("String expected in evil function");t=t.replace(/\n/g,"\\n"),Observable.isObservable(e)&&(e=e());var r,s,o="context"+Math.floor(1e7*Math.random()),a=[o],u=[];for(s in n)a.push(s),u.push(n[s]);return e?a.push("with("+o+") return "+t):a.push("return "+t),r=Function.apply(e,a),u.unshift(e),function(){try{return r.apply(e,u)}catch(s){if(i)throw s;console.log('Error "'+s.message+'" in expression "'+t+'" Context: ',e,"addArgs: ",n)}}},a.findCallAndSubscribe=function(t,e,n,i,r){var s=this.findObservable(t,e,n,r);return i(s.value),s.subscribe(i),s},a.findObservable=function(t,e,n,i){var r=new ObjectObservable({evil:{string:t,context:e,addArgs:n},$el:i});return r},a.findBinds=function(t,e,i){var r,s,o=!1,a=this,u=n(t),c=u[0];if(!c)throw Error("Element not exists");return(s=a.tags[c.tagName.toLowerCase()])?(s.call(a,u,e,i),void 0):(_.forIn(_.foldl(c.attributes,function(t,e){return t[e.nodeName]=e.nodeValue,t},{}),function(t,n){var s=a.customAttributes[n];s&&(r=s.call(a,u,t,e,i),r===!1?o=!0:r&&(e=r))}),o||u.contents().each(function(){var t=this;3==this.nodeType?_.forIn(a.inlineModificators,function(n){n.call(a,t,e,i)}):1==this.nodeType&&a.findBinds(t,e,i)}),void 0)},e=function(t){var e={};return _.each(t.split(o),function(t){var n=s.exec(t);n&&(e[n[1]]=n[2])}),e},a.parseOptionsObject=function(t){var n,i={},r=0,s=function(t){t.match(/\{[^{}]*\}/)&&s(t.replace(/\{[^{}]*\}/,function(t){var n=Math.random()+r++;return i[n]=e(t.slice(1,-1)),n}))};if(s(t),_.each(i,function(t){_.each(t,function(e,n){i[e]&&(t[n]=i[e],delete i[e])})}),_.each(i,function(t){n=t}),!n)throw Error(t+" is not valid options object");return n},t.ViewModel=a}(this),function(){"use strict";var t=/\s*\|\s*/,e=/(\w+)(:['"]([^'"]+)['"])?/,n=function(t){return t||(0===t?"0":"")};ViewModel.filters={},ViewModel.applyFilters=function(n,i,r,s,o){var a=n.split(t);if(1>=a.length)return this.findCallAndSubscribe(n,i,r,s,o);n=a.shift();var u=this.findObservable(n,i,r,o);a=_.foldl(a,function(t,n){var i=e.exec(n),r=i[1];return t.push({unformat:ViewModel.filters[r].unformat,format:ViewModel.filters[r].format,key:r,value:i[3]||""}),t},[]);var c=new ObjectObservable({get:function(){return _.foldl(a,function(t,e){return e.format.call(ViewModel,t,e.value)},u.get())},set:function(t){u.set(_.foldr(a,function(t,e){return e.unformat.call(ViewModel,t,e.value)},t))},$el:o});return s&&(s(c.value),c.subscribe(s)),c},ViewModel.binds={log:function(t,e,n,i){this.findCallAndSubscribe(e,n,i,function(t){console.log(n,".",e,"=",t)},t)},src:function(t,e,n,i){var r=t[0];this.findCallAndSubscribe(e,n,i,function(t){r.src=t||""},t)},html:function(t,e,i,r){this.applyFilters(e,i,r,function(e){t.html(n(e))},t)},text:function(t,e,n,i){this.findCallAndSubscribe(e,n,i,function(e){t.text(e)},t)},"with":function(t,e,n,i){return this.evil(e,n,i)()},each:function(t,e,n,i){var r=t.html();return i=i?_.clone(i):{},this.findCallAndSubscribe(e,n,i,function(e){t.children().clearBinds(),t.empty();var n=document.createDocumentFragment();e&&(_.each(e,function(t,s){i.$index=s,i.$parent=e,i.$value=t,$(r).each(function(){ViewModel.findBinds(this,t,i),n.appendChild(this)})}),t[0].appendChild(n))},t),!1},value:function(t,e,i,r){var s=this.applyFilters(e,i,r,function(e){t.val(n(e))},t);t.on("change keyup keydown",function(){var e=t.val();s.set(e)})},attr:function(t,e,n,i){var r=t[0];_.each(this.parseOptionsObject(e),function(e,s){ViewModel.findCallAndSubscribe(e,n,i,function(t){t!==!1&&void 0!==t&&null!==t?r.setAttribute(s,t):r.removeAttribute(s)},t)})},style:function(t,e,n,i){_.each(this.parseOptionsObject(e),function(e,r){ViewModel.findObservable(e,n,i,t).callAndSubscribe(function(e){t.css(r,e)})})},css:function(t,e,n,i){_.each(this.parseOptionsObject(e),function(e,r){ViewModel.findObservable(e,n,i,t).callAndSubscribe(function(e){e?t.addClass(r):t.removeClass(r)})})},display:function(t,e,n,i){this.findObservable(e,n,i,t).callAndSubscribe(function(e){e?t.show():t.hide()})},click:function(t,e,n,i){var r=this.evil(e,n,i,t)();t.click(function(){r.apply(n,arguments)})},className:function(t,e,n,i){var r;this.findObservable(e,n,i,t).callAndSubscribe(function(e){r&&t.removeClass(r),e&&t.addClass(e),r=e})},events:function(t,e,n,i){var r=this;_.each(this.parseOptionsObject(e),function(e,s){var o=r.evil(e,n,i)();t.bind(s,function(t){o.call(n,t)})})},view:function(t,e,n,i){var r,s,o,a,u;try{r=this.parseOptionsObject(e)}catch(c){u=e.split(/\s*,\s*/),r={"class":u[0],name:u[1]}}return s=r["class"]?this.evil(r["class"],n,i)():ViewModel.extend({autoParseBinds:!0}),o={el:t},r.options&&_.forOwn(r.options,function(t,e){o[e]=ViewModel.evil(t,n,i)()}),a=new s(o),r.name&&(n[r.name]=a),!1},$click:function(t,e,n,i){return t.click(this.evil(e,n,i)),!1}};var i=/\s*;\s*/,r=/^\s*([^:]+)\s*:\s*([\s\S]*\S)\s*$/,s=/\s*,\s*/,o=function(t,e,n,o,a){e.removeAttr(t);var u,c;return n&&_.each(n.split(i),function(t){var n,i,h,l=t.match(r);l?(n=l[1],i=l[2]):(n=t,i=""),n=n.split(s),_.each(n,function(t){t&&"!"!==t.charAt(0)&&(h=ViewModel.binds[t],h?(u=h.call(ViewModel,e,i,o,a),u===!1?c=!0:u&&(o=u)):console.warn('Bind: "'+t+'" not exists'))})}),c?!1:o};ViewModel.tag=function(t,e){document.createElement(t),ViewModel.tags[t]=e},ViewModel.removeTag=function(t){delete ViewModel.tags[t]},ViewModel.tags={},ViewModel.customAttributes={"data-bind":function(t,e,n,i){return o("data-bind",t,e,n,i)},nk:function(t,e,n,i){return o("nk",t,e,n,i)}},ViewModel.filters._sysUnwrap={format:function(t){return Observable.isObservable(t)?t():t}},ViewModel.filters._sysEmpty={format:n},ViewModel.inlineModificators={"{{}}":function(t,e,n){var i,r,s,o,a=t.nodeValue,u=this,c=[t],h=ViewModel.inlineModificators["{{}}"].regex;if(h.lastIndex=0,h.test(a)){i=t.parentNode,o=$(i),s=document.createElement("div");var l=0,f={};h.lastIndex=0,a='"'+a.replace(h,function(t,i){return l++,f["___comp"+l]=u.applyFilters(i+" | _sysUnwrap | _sysEmpty",e,n,void 0,o).getter,'"+___comp'+l+'()+"'})+'"',u.findCallAndSubscribe(a,f,n,1===i.childNodes.length?function(t){try{i.innerHTML=t}catch(e){console.log(e)}}:function(t){r=document.createDocumentFragment();try{s.innerHTML=t}catch(e){console.log(e)}var n,o=_.toArray(s.childNodes);for(n=c[0];c[1];)i.removeChild(c[1]),c.splice(1,1);if(!o.length)return n.nodeValue="",c=[n],void 0;for(;s.childNodes[0];)r.appendChild(s.childNodes[0]);if(r.childNodes.length)try{i.insertBefore(r,n)}catch(a){throw a}i.removeChild(n),c=o},o)}}},ViewModel.inlineModificators["{{}}"].regex=/\{\{([\s\S]+?)\}\}/g}(),function(){"use strict";var t={},e={};ViewModel.tmpl={setRawTemplate:function(e,n){t[e]=n},getRawTemplate:function(e){return t[e]},get:function(n,i){var r,s=e[n];if(!s){if(r=t[n],void 0===r)throw Error('Raw template: "'+n+'" is not defined');e[n]=s=i(r)}return s}},ViewModel.binds.template=function(n,i,r,s){var o=$(n),a=i.split(/\s*,\s*/),u=a[0],c=a[1];return t[u]=o.html(),o.remove(),c&&(c=this.evil(c,r,s),e[u]=c(t[u])),!1}}(),function(){"use strict";var t=function(t,e,n,i,r){var s,o,a={};i.$parent=n,i.$self=Computed({initial:e.value,$el:t});var u=function(e){if(i.$self(e),s&&s.off(0,0,r),e)_.extend(a,e.attributes),e.on("change",function(e){_.extend(a,e),t.refreshBinds()},r);else for(o in a)delete a[o];t.refreshBinds(),s=e};return u(e.value),e.subscribe(u),t.each(function(){ViewModel.findBinds(this,a,i)}),i};ViewModel.binds.withModel=function(e,n,i,r){return r=r||{},t(e.children(),this.findObservable(n,i,r,e),i,r,{}),!1},ViewModel.binds.eachModel=function(e,n,i,r){var s,o,a,u,c,h=e[0],l={},f=h.tagName.toLowerCase();return s=n.split(/\s*,\s*/),o=s[0],a=s[1],c=a?"":e.html(),this.findObservable(o,i,r,e).callAndSubscribe(function(n){u&&(u.off(0,0,l),u.each(function(t){t.off(0,0,l)})),u=n,e.empty();var i,r,s,o;n&&(i=1,r=function(e){return function(r,s){var o,a=$(e);return o=t(a,Computed({initial:r,$el:a}).obj,n,{$index:s},l),i=a.length,a}},s=a?ViewModel.tmpl.get(a,r):r(c),o=function(){var t=n.getIndex(n.at(0))-1;e.children().clearBinds(),e.empty(),0>t&&(t=0),n.each(function(i){e.append(s(i,t++,n))})},o(),n.on("add",function(t,r,o){var a=0,u="",c=o||r;u=$(document.createElement(f)),_.each(t,function(t){u.append(s(t,c+a++,n))}),u=u.children(),0===r?e.prepend(u):r&&r!==n.length-t.length?e.children().eq(r*i).before(u):e.append(u)},l),n.on("beforeReset",function(t){_.each(t,function(t){t.off(0,0,l)})},l),n.on("reset",o,l),n.on("cut",function(t){var n=e.children();_.each(t,function(t,e){e*=1,t.off(0,0,l),n.slice(e,e+i).clearBinds().empty().remove()})},l),n.on("sort",function(t){var n=$(document.createElement("div")),r=e.children();_.each(t,function(t,e){e*=1,n.append(r.slice(e,e+i))}),e.append(n.children())},l))}),!1}}(),function(t){"use strict";var e=/\((.*?)\)/g,n=/(\(\?)?:\w+/g,i=/\*\w+/g,r=/[\-{}\[\]+?.,\\\^$|#\s]/g;t.Router=Events.extend({constructor:function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},initialize:function(){},route:function(e,n,i){_.isRegExp(e)||(e=this._routeToRegExp(e)),_.isFunction(n)&&(i=n,n=""),i||(i=this[n]);var r=this;return t.History.route(e,function(s){var o=r._extractParameters(e,s);i&&i.apply(r,o),r.trigger.apply(r,["route:"+n].concat(o)),r.trigger("route",n,o),t.History.trigger("route",r,n,o)}),this},navigate:function(e,n){return t.History.navigate(e,n),this},_bindRoutes:function(){if(this.routes){this.routes=_.result(this,"routes");for(var t,e=_.keys(this.routes);null!=(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(r,"\\$&").replace(e,"(?:$1)?").replace(n,function(t,e){return e?t:"([^/]+)"}).replace(i,"(.*?)"),RegExp("^"+t+"$")},_extractParameters:function(t,e){var n=t.exec(e).slice(1);return _.map(n,function(t){return t?decodeURIComponent(t):null})}})}(this),function(t){"use strict";var e=/^[#\/]|\s+$/g,n=/^\/+|\/+$/g,i=/msie [\w.]+/,r=/\/$/,s=Events.extend({interval:50,started:!1,constructor:function(){this.handlers=[],_.bindAll(this,"checkUrl"),t!==void 0&&(this.location=t.location,this.history=t.history)},getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getFragment:function(t,n){if(null==t)if(this._hasPushState||!this._wantsHashChange||n){t=this.location.pathname;var i=this.root.replace(r,"");t.indexOf(i)||(t=t.slice(i.length))}else t=this.getHash();return t.replace(e,"")},start:function(r){if(this.started)throw Error("Backbone.history has already been started");this.started=!0,this.options=_.extend({},{root:"/"},this.options,r),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var s=this.getFragment(),o=document.documentMode,a=i.exec(navigator.userAgent.toLowerCase())&&(!o||7>=o);this.root=("/"+this.root+"/").replace(n,"/"),a&&this._wantsHashChange&&(this.iframe=$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(s)),this._hasPushState?$(t).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in t&&!a?$(t).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=s;var u=this.location,c=u.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!c)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._hasPushState&&c&&u.hash&&(this.fragment=this.getHash().replace(e,""),this.history.replaceState({},document.title,this.root+this.fragment+u.search))}return this.options.silent?void 0:this.loadUrl()},stop:function(){$(t).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),this.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(){var t=this.getFragment();return t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe))),t===this.fragment?!1:(this.iframe&&this.navigate(t),this.loadUrl(),void 0)},loadUrl:function(t){var e=this.fragment=this.getFragment(t);return _.any(this.handlers,function(t){return t.route.test(e)?(t.callback(e),!0):void 0})},navigate:function(t,e){if(!this.started)return!1;if(e&&e!==!0||(e={trigger:!!e}),t=this.getFragment(t||""),this.fragment!==t){this.fragment=t;var n=this.root+t;if(""===t&&"/"!==n&&(n=n.slice(0,-1)),this._hasPushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getFragment(this.getHash(this.iframe))&&(e.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,t,e.replace))}return e.trigger?this.loadUrl(t):void 0}},_updateHash:function(t,e,n){if(n){var i=t.href.replace(/(javascript:|#).*$/,"");t.replace(i+"#"+e)}else t.hash="#"+e}});t.History=new s}(this);