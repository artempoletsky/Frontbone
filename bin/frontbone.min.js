/*! frontbone 2013-07-30 */
(function(t){"use strict";var e,n,i,r=[],s=!1,o=!1,c=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.msRequestAnimationFrame||t.oRequestAnimationFrame||function(t){setTimeout(function(){t()},1e3/15)};t.ComputedRefresher={refreshAll:function(){_.each(r,function(t){t.notify()}),r=[]},startRefresh:function(){var t=this;s=!0,c(function(){s&&(t.refreshAll(),t.startRefresh())})},stopRefresh:function(){s=!1}};var u=t.ObjectObservable=function(t){t=t||{},this.dependencies=[],this.selfCallbacks=[],this.listeners=[];var n=t.initial,i=t.$el;if(t.evil){var r=ViewModel.evil(t.evil.string,t.evil.context,t.evil.addArgs);o=this;var s=r();e.isObservable(s)?(n=s(),this.getter=function(){return s()},this.setter=function(t){return s(t),t}):(n=s,this.getter=function(){return r()}),o=!1}else t.get&&(o=this,n=t.get(),o=!1,this.getter=t.get);if(i){var c=i.data("nk_observers");c=c||[],c.push(this),i.data("nk_observers",c)}t.set&&(this.setter=t.set),this.lastValue=this.value=n,this.dirty=t.dirty};u.prototype={setter:function(t){return t},getter:function(){return o&&o.dependsOn(this),this.value},set:function(t){return this.value=this.setter(t),this.notify()},get:function(){return this.getter()},destroy:function(){var t=this;_.each(t.dependencies,function(e,n){e.unsubscribe(t.selfCallbacks[n])}),t.dependencies=void 0,t.selfCallbacks=void 0,t.listeners=[],t.value=void 0,t.lastValue=void 0},dependsOn:function(t){var e=this;if(-1===e.dependencies.indexOf(t)){e.dependencies.push(t);var n=function(){e.notify()};e.selfCallbacks.push(n),t.subscribe(n)}return e},subscribe:function(t){return this.listeners.push(t),this},unsubscribe:function(t){return this.listeners=_.filter(this.listeners,function(e){return e!==t}),this},notify:function(){var t=this,e=t.get();return t.lastValue!==e&&_.each(t.listeners,function(t){t(e)}),t.lastValue=e,t},fire:function(){var t=this,e=t.get();return _.each(t.listeners,function(t){t(e)}),t},callAndSubscribe:function(t){return t(this.get()),this.subscribe(t)},valueOf:function(){return this.get()},toString:function(){return this.get()}},i=function(t){var e=new u(t),n=function(t){return 0!==arguments.length?(e.set(t),t):e.get()};return _.extend(n,{obj:e,subscribe:function(t){return e.subscribe(t),this},unsubscribe:function(t){return e.unsubscribe(t),this},fire:function(){return e.fire(),this},_notSimple:!0,__observable:!0}),n.valueOf=n.toString=function(){return n()},n},e=function(t){return i({initial:t})},e.isObservable=function(t){return"function"!=typeof t?!1:t.__observable||!1},n=function(t,e){if(e)throw Error("Context for computed is obsolete");return i("function"==typeof t?{get:t}:t)},t.Observable=e,t.Computed=n})(this),function(t){"use strict";var e=function(){},n=function(){},i=/xyz/.test(function(){alert("xyz")})?/\b_super\b/:/.*/;n.prototype._constructor=Object,n.prototype.constructor=n,n.extend=function(t){"function"==typeof t&&(t={constructor:t});var n=this,r=function(){this._constructor.apply(this,arguments)};return t.hasOwnProperty("constructor")&&(t._constructor=t.constructor),e.prototype=n.prototype,r.prototype=new e,_.forOwn(t,function(t,e){r.prototype[e]="function"==typeof t&&void 0===t._notSimple&&i.test(""+t)?function(){var i,r=this._super;return this._super=n.prototype[e],i=t.apply(this,arguments),this._super=r,i}:t}),r.prototype.constructor=r,r._notSimple=!0,r.extend=n.extend,r.create=n.create,r},n.create=function(t){var e,n,i,r=_.toArray(arguments),s=this.extend(t),o="return new child(",c=["child"],u=[s];if(r.shift(),e=r.length,e>0){for(n=0;e>n;n++)o+="arg"+n+", ",c.push("arg"+n),u.push(r[n]);o=o.substr(0,o.length-2)}o+=");",c.push(o);try{i=Function.apply(void 0,c).apply(void 0,u)}catch(a){throw a}return i},t.Class=n}(this),function(t){"use strict";Array.prototype.indexOf||(Array.prototype.indexOf=function(t,e){return _.indexOf(this,t,e)});var e=/\s+/,n=".",i=function(t,e,i,r){t+="";var s=t.split(n);return{c:i,s:r,fn:e,n:s[0],ns:s.slice(1),o:t}},r=function(t,e){var n,i;n=t._listeners||{},i=n[e.n]||[],i.push(e),n[e.n]=i,t._listeners=n},s=function(t,e,n,r,s){var o="any"===s?!1:[],c=i(e,n,r);return s||(s="filter"),_.each(t,function(t){return _.each(t,function(t){var e,n=!(c.fn&&c.fn!==t.fn||c.n&&c.n!==t.n||c.c&&c.c!==t.c);if(n&&c.ns.length&&(e=t.ns,n=!_.any(c.ns,function(t){return e.indexOf(t)})),n){if("filter"===s)o.push(t);else if("any"===s)return o=!0,!1}else"invert"===s&&o.push(t)}),o===!0?!1:void 0}),o},o=function(t,e,n,o){var c,u,a;if(t._listeners){if(!e&&!n&&!o)return delete t._listeners,void 0;if(c=i(e,n,o),!c.ns.length&&!n&&!o)return delete t._listeners[c.n],void 0;for(u=s(t._listeners,e,n,o,"invert"),delete t._listeners,a=u.length-1;a>=0;a--)r(t,u[a])}},c=Class.extend({on:function(t,n,s,o){var c,u=this;if(_.isObject(t))return c=n||u,_.each(t,function(t,e){u.on(e,t,c,o)}),this;if("function"!=typeof n)throw TypeError("function expected");return s||(s=this),_.each(t.split(e),function(t){r(u,i(t,n,s,o))}),u},off:function(t,n,i){var r=this;return t?(_.each(t.split(e),function(t){o(r,t,n,i)}),r):(o(r,"",n,i),r)},fire:function(t){if(!this._listeners)return this;var n=_.rest(arguments,1),i=this;return _.each(t.split(e),function(t){_.each(s(i._listeners,t,!1,!1),function(t){t.s&&i.off(0,t.fn),t.fn.apply(t.c,n)})}),i},one:function(t,e,n){return this.on(t,e,n,!0)},hasListener:function(t){return this._listeners?s(this._listeners,t,!1,!1,"any"):!1}});c.prototype.trigger=c.prototype.fire,t.Events=c}(this),function(t){"use strict";var e={},n=Events.extend({constructor:function(t){t=t||{},this.attributes=_.extend({},this.defaults,this.parse(t)),this._changed={},this.id=this.attributes[this.idAttribute],this.cid=_.uniqueId("c"),this.mapping&&this.id&&(e[this.mapping]=e[this.mapping]||{},e[this.mapping][this.id]=this),this.initialize()},initialize:function(){return this},idAttribute:"id",mapping:!1,defaults:{},toJSON:function(){return _.clone(this.attributes)},parse:function(t){return t},baseURL:"/",url:function(){return this.baseURL+(this.mapping?this.mapping+"/":"")+(this.id?this.id+"/":"")},update:function(t){return this.prop(this.parse(t)),this._changed={},this},prop:function(t,e){if(1===arguments.length&&"string"==typeof t)return this.attributes[t];var n={},i=this,r={};return"string"==typeof t?n[t]=e:n=t,_.each(n,function(t,e){r[e]=i._changed[e]=i.attributes[e]=t,e===i.idAttribute&&(i.id=t),i.fire("change:"+e)}),this.fire("change",r),this},get:function(){return this.prop.apply(this,arguments)},set:function(){return this.prop.apply(this,arguments)},validate:function(){return!0},fetch:function(t){t=t||{};var e=this,i={success:function(n){e.update(n),"function"==typeof t.success&&t.success.apply(e,arguments)},error:function(){"function"==typeof t.error&&t.error.apply(e,arguments)}};return n.sync("read",this.url(),_.extend({},t,i)),this},save:function(){var t=this;if(!this.validate())throw Error("Model is invalid");if(this.id){if(0===_.keys(t._changed).length)return this;n.sync("update",this.url(),{data:t._changed,success:function(e){t.update(e)}})}else n.sync("create",this.url(),{data:_.clone(this.attributes),success:function(e){t.update(e)}});return this},remove:function(){this.fire("remove"),this.id&&n.sync("delete",this.url(),{})}});n.fromStorage=function(t,n){return e[t]=e[t]||{},e[t][n]},n.createOrUpdate=function(t,e){var i,r,s,o=t.prototype;return o.mapping&&(r=o.idAttribute,s=o.parse(e),i=n.fromStorage(o.mapping,s[r]))?(i.update(e),i):new t(e)},n.sync=function(t,e,n){n=n||{};var i={method:t};"PUT"===t&&(t="POST"),$.extend(i,n.data),$.ajax({url:e,dataType:"json",type:t,data:i,success:n.success,error:n.error})},t.Model=n}(this),function(t){"use strict";var e=function(t){this.self=t},n=Model.extend({constructor:function(t,n){this.attributes={},this._changed={},this.itself=new e(this),this.models=[],this.length=0,this._hashId=[],t&&this.reset(t),this.initialize(n)},models:[],model:Model,url:function(){return this.baseURL+this.model.prototype.mapping+"/"},fetch:function(t){t=t||{};var e=this,n={success:function(n){e.reset(n,t),"function"==typeof t.success&&t.success.apply(e,arguments)},error:function(){"function"==typeof t.error&&t.error.apply(e,arguments)}},i=_.extend({},t,n);Model.sync("GET",this.url(),i)},reset:function(t,e){if(e=e||{},e.add||(this.fire("beforeReset",this.models),this.models=[],this.length=0,this._hashId=[]),!t)return this.fire("reset"),this;var n=this.parse(t);return this.add(n,"end",!e.add),e.add||this.fire("reset"),this},push:function(t){return this.add(t)},unshift:function(t){return this.add(t,0)},add:function(t,e,n){function i(t,e){if(0===e&&o.length)r=o._hashId[0].index-1,o._hashId.unshift({id:t.id,index:r});else{var n=o._hashId.length;r=0===n?1:o._hashId[n-1].index+1,o._hashId.push({id:t.id,index:r})}}var r,s,o=this,c=[],u=0;return t instanceof Array||(t=[t]),"number"!=typeof e?(e=this.length,u=this.getIndex(this.models[this.length-1])):0===e&&(s=_.clone(t).reverse(),u=this.getIndex(this.models[0])-s.length-1),_.each(t,function(t,n){t instanceof Model||(t=Model.createOrUpdate(o.model,t)),c.push(t),s?i(s[n],0):i(t,e+n),t.one("remove",function(){o.cutByCid(this.cid)}),o.models.splice(e+n,0,t)}),this.length=this.models.length,n||this.fire("add",c,e,u),this},cut:function(t){var e,n=this;return this.each(function(i,r){return i.id===t?(e=n.cutAt(r),!1):void 0}),e},cutByCid:function(t){var e,n=this;return this.each(function(i,r){return i.cid===t?(e=n.cutAt(r),!1):void 0}),e},shift:function(){return this.cutAt(0)},pop:function(){return this.cutAt()},cutAt:function(t){void 0===t&&(t=this.models.length-1);var e,n=this.models.splice(t,1)[0];return this._hashId.splice(t,1),this.length=this.models.length,e={},e[t]=n,this.fire("cut",e),n},at:function(t){return this.models[t]},get:function(){return this.getByID.apply(this,arguments)},getByID:function(t){var e;return this.each(function(n){return n.id==t?(e=n,!1):void 0}),e},getByCid:function(t){var e;return this.each(function(n){return n.cid==t?(e=n,!1):void 0}),e},getIndex:function(t){if(!t)return 0;var e=this.indexOf(t);return this._hashId[e].index}}),i=["forEach","each","map","reduce","reduceRight","find","foldl","foldr","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortByDesc","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"],r=function(t){return _.isFunction(t)?t:function(e){return e[t]}},s=["filter","reject"],o=["sortBy","sortByDesc","shuffle"];_.sortByDesc=function(t,e,n){var i=r(e);return _.pluck(_.map(t,function(t,e,r){return{value:t,index:e,criteria:i.call(n,t,e,r)}}).sort(function(t,e){var n=t.criteria,i=e.criteria;if(n!==i){if(n>i||void 0===n)return-1;if(i>n||void 0===i)return 1}return t.index<e.index?-1:1}),"value")},_.each(i,function(t){n.prototype[t]=function(){return _[t].apply(_,[this.models].concat(_.toArray(arguments)))}}),_.each(s,function(t){e.prototype[t]=function(){var e="filter"===t?"reject":"filter",n=this.self,i=_.toArray(arguments),r=_[t].apply(_,[n.models].concat(i)),s=_[e].apply(_,[n.models].concat(i)),o={};return _.each(s,function(t){o[n.indexOf(t)]=t}),n.models=r,n.length=r.length,n.fire("cut",o),n}}),_.each(o,function(t){e.prototype[t]=function(){var e=this.self,n=_[t].apply(_,[e.models].concat(_.toArray(arguments))),i={};return _.each(n,function(t,n){i[e.indexOf(t)]=n}),e.models=n,e.length=n.length,e.fire("sort",i),e}}),t.Collection=n}(this),function(t){"use strict";var e,n=t.$,i=/\s+/,r=/^[a-z]+$/,s=/^\s*([^:]+)\s*:\s*([\s\S]*\S)\s*$/,o=/\s*,\s*/,c={setElement:function(t){return this.undelegateEvents(),this.el=t,this.$el=n(t),this.parse().delegateEvents(),this},constructor:function(t){t=t||{},this.options=t,t.collection&&(this.collection=t.collection),this.model=t.model,t.el&&(this.el=t.el);var e=this;e._cid||(e._cid=_.uniqueId("vm")),e.el||(e.el="div"),"string"==typeof e.el&&(e.el=r.test(e.el)&&"html"!==e.el&&"body"!==e.el?document.createElement(e.el):n(e.el)[0]),e.$el=n(e.el),e.$=function(t){return e.$el.find(t)},e.initialize(),e.autoParseBinds&&e.parse(),e.delegateEvents()},remove:function(){return this.$el.remove(),this},parse:function(){return c.findBinds(this.el,this),this},autoParseBinds:!1,initialize:function(){},delegateEvents:function(t){t=t||this.events,this.undelegateEvents();var e,n,r=this;return _.each(t,function(t,s){var o,c="function"==typeof t?t:r[t];if("function"!=typeof c)throw TypeError(t+" is not a function");e=s.split(i),n=e.shift().split(",").join("."+r._cid+" ")+"."+r._cid,o=_.bind(c,r),e.length?r.$el.delegate(e.join(" "),n,o):r.$el.bind(n,o)}),this},undelegateEvents:function(){return this.$el.unbind("."+this._cid),this},render:function(){return this}};c=Events.extend(c),n.fn.clearBinds=function(){var t=n();return t.length=1,this.each(function(){t[0]=this,_.each(t.data("nk_observers"),function(t){t.destroy()}),t.data("nk_observers",[]),t.children().clearBinds()}),this},n.fn.refreshBinds=function(){var t=n();return t.length=1,this.each(function(){t[0]=this,_.each(t.data("nk_observers"),function(t){t.notify()}),t.children().refreshBinds()}),this},c.evil=function(t,e,n,i){if(n=n||{},"string"!=typeof t)throw new TypeError("String expected in evil function");t=t.replace(/\n/g,"\\n"),Observable.isObservable(e)&&(e=e());var r,s="context"+Math.floor(1e7*Math.random()),o=[s],c=[];return _.each(n,function(t,e){o.push(e),c.push(t)}),e?o.push("with("+s+") return "+t):o.push("return "+t),r=Function.apply(e,o),c.unshift(e),function(){try{switch(c.length){case 1:return r.call(e,e);case 2:return r.call(e,e,c[1]);case 3:return r.call(e,e,c[1],c[2]);case 4:return r.call(e,e,c[1],c[2],c[3]);case 5:return r.call(e,e,c[1],c[2],c[3],c[4]);case 6:return r.call(e,e,c[1],c[2],c[3],c[4],c[5]);default:return r.apply(e,c)}}catch(s){if(i)throw s;console.log('Error "'+s.message+'" in expression "'+t+'" Context: ',e,"addArgs: ",n)}}},c.findCallAndSubscribe=function(t,e,n,i,r){var s=this.findObservable(t,e,n,r);return i(s.value),s.subscribe(i),s},c.findObservable=function(t,e,n,i){var r=new ObjectObservable({evil:{string:t,context:e,addArgs:n},$el:i});return r},c.findBinds=function(t,e,i){var r,s,o=!1,c=this,u=n(t),a=u[0];if(!a)throw Error("Element not exists");return(s=c.tags[a.tagName.toLowerCase()])?(s.call(c,u,e,i),void 0):(_.forIn(_.foldl(a.attributes,function(t,e){return t[e.nodeName]=e.nodeValue,t},{}),function(t,n){var s=c.customAttributes[n];s&&(r=s.call(c,u,t,e,i),r===!1?o=!0:r&&(e=r))}),o||u.contents().each(function(){var t=this;3==this.nodeType?_.forIn(c.inlineModificators,function(n){n.call(c,t,e,i)}):1==this.nodeType&&c.findBinds(t,e,i)}),void 0)},e=function(t){var e={};return _.each(t.split(o),function(t){var n=s.exec(t);n&&(e[n[1]]=n[2])}),e},c.parseOptionsObject=function(t){var n,i={},r=0,s=function(t){t.match(/\{[^{}]*\}/)&&s(t.replace(/\{[^{}]*\}/,function(t){var n=Math.random()+r++;return i[n]=e(t.slice(1,-1)),n}))};if(s(t),_.each(i,function(t){_.each(t,function(e,n){i[e]&&(t[n]=i[e],delete i[e])})}),_.each(i,function(t){n=t}),!n)throw Error(t+" is not valid options object");return n},t.ViewModel=c}(this),function(){"use strict";var t=/\s*\|\s*/,e=/(\w+)(:['"]([^'"]+)['"])?/;ViewModel.filters={},ViewModel.applyFilters=function(n,i,r,s,o){var c=n.split(t);if(1>=c.length)return this.findCallAndSubscribe(n,i,r,s,o);n=c.shift();var u=this.findObservable(n,i,r,o);c=_.foldl(c,function(t,n){var i=e.exec(n),r=i[1];return t.push({unformat:ViewModel.filters[r].unformat,format:ViewModel.filters[r].format,key:r,value:i[3]||""}),t},[]);var a=new ObjectObservable({get:function(){return _.foldl(c,function(t,e){return e.format.call(ViewModel,t,e.value)},u.get())},set:function(t){u.set(_.foldr(c,function(t,e){return e.unformat.call(ViewModel,t,e.value)},t))},$el:o});return s&&(s(a.value),a.subscribe(s)),a},ViewModel.binds={log:function(t,e,n,i){this.findCallAndSubscribe(e,n,i,function(t){console.log(n,".",e,"=",t)},t)},src:function(t,e,n,i){var r=t[0];this.findCallAndSubscribe(e,n,i,function(t){r.src=t||""},t)},html:function(t,e,n,i){this.applyFilters(e,n,i,function(e){e||"number"==typeof e||(e=""),t.html(e)},t)},text:function(t,e,n,i){this.findCallAndSubscribe(e,n,i,function(e){t.text(e)},t)},"with":function(t,e,n,i){return this.evil(e,n,i)()},each:function(t,e,n,i){var r=t.html();return i=i?_.clone(i):{},this.findCallAndSubscribe(e,n,i,function(e){t.children().clearBinds(),t.empty(),e&&_.each(e,function(n,s){i.$index=s,i.$parent=e,i.$value=n;var o=document.createElement("div");try{o.innerHTML=r}catch(c){console.log(c)}ViewModel.findBinds(o,n,i),t.append($(o).children())})},t),!1},value:function(t,e,n,i){var r=this.findObservable(e,n,i,t).callAndSubscribe(function(e){t.val(e)});t.change(function(){r(t.val())})},attr:function(t,e,n,i){var r=t[0];_.each(this.parseOptionsObject(e),function(e,s){ViewModel.findCallAndSubscribe(e,n,i,function(t){t!==!1&&void 0!==t&&null!=t?r.setAttribute(s,t):r.removeAttribute(s)},t)})},style:function(t,e,n,i){_.each(this.parseOptionsObject(e),function(e,r){ViewModel.findObservable(e,n,i,t).callAndSubscribe(function(e){t.css(r,e)})})},css:function(t,e,n,i){_.each(this.parseOptionsObject(e),function(e,r){ViewModel.findObservable(e,n,i,t).callAndSubscribe(function(e){e?t.addClass(r):t.removeClass(r)})})},display:function(t,e,n,i){this.findObservable(e,n,i,t).callAndSubscribe(function(e){e?t.show():t.hide()})},click:function(t,e,n,i){var r=this.evil(e,n,i,t)();t.click(function(){r.apply(n,arguments)})},className:function(t,e,n,i){var r;this.findObservable(e,n,i,t).callAndSubscribe(function(e){r&&t.removeClass(r),e&&t.addClass(e),r=e})},events:function(t,e,n,i){var r=this;_.each(this.parseOptionsObject(e),function(e,s){var o=r.evil(e,n,i)();t.bind(s,function(t){o.call(n,t)})})},view:function(t,e,n,i){var r,s,o,c,u;try{r=this.parseOptionsObject(e)}catch(a){u=e.split(/\s*,\s*/),r={"class":u[0],name:u[1]}}return s=r["class"]?this.evil(r["class"],n,i)():ViewModel.extend({autoParseBinds:!0}),o={el:t},r.options&&_.forOwn(r.options,function(t,e){o[e]=ViewModel.evil(t,n,i)()}),c=new s(o),r.name&&(n[r.name]=c),!1},$click:function(t,e,n,i){return t.click(this.evil(e,n,i)),!1}};var n=/\s*;\s*/,i=/^\s*([^:]+)\s*:\s*([\s\S]*\S)\s*$/,r=/\s*,\s*/,s=function(t,e,s,o,c){e.removeAttr(t);var u,a;return s&&_.each(s.split(n),function(t){var n,s,l,f=t.match(i);f?(n=f[1],s=f[2]):(n=t,s=""),n=n.split(r),_.each(n,function(t){t&&"!"!==t.charAt(0)&&(l=ViewModel.binds[t],l?(u=l.call(ViewModel,e,s,o,c),u===!1?a=!0:u&&(o=u)):console.warn('Bind: "'+t+'" not exists'))})}),a?!1:o};ViewModel.tag=function(t,e){document.createElement(t),ViewModel.tags[t]=e},ViewModel.removeTag=function(t){delete ViewModel.tags[t]},ViewModel.tags={},ViewModel.customAttributes={"data-bind":function(t,e,n,i){return s("data-bind",t,e,n,i)},nk:function(t,e,n,i){return s("nk",t,e,n,i)}},ViewModel.filters._sysUnwrap={format:function(t){return Observable.isObservable(t)?t():t}},ViewModel.filters._sysEmpty={format:function(t){return t||(0===t?"0":"")}},ViewModel.inlineModificators={"{{}}":function(t,e,n){var i,r,s,o,c=t.nodeValue,u=this,a=[t],l=ViewModel.inlineModificators["{{}}"].regex;if(l.lastIndex=0,l.test(c)){i=t.parentNode,o=$(i),s=document.createElement("div");var f=0,h={};l.lastIndex=0,c='"'+c.replace(l,function(t,i){return f++,h["___comp"+f]=u.applyFilters(i+" | _sysUnwrap | _sysEmpty",e,n,void 0,o).getter,'"+___comp'+f+'()+"'})+'"',u.findCallAndSubscribe(c,h,n,1==i.childNodes.length?function(t){try{i.innerHTML=t}catch(e){console.log(e)}}:function(t){r=document.createDocumentFragment();try{s.innerHTML=t}catch(e){console.log(e)}var n,o=_.toArray(s.childNodes);for(n=a[0];a[1];)i.removeChild(a[1]),a.splice(1,1);if(!o.length)return n.textContent="",a=[n],void 0;for(;s.childNodes[0];)r.appendChild(s.childNodes[0]);if(r.childNodes.length)try{i.insertBefore(r,n)}catch(c){throw c}i.removeChild(n),a=o},o)}}},ViewModel.inlineModificators["{{}}"].regex=/\{\{([\s\S]+?)\}\}/g}(),function(){"use strict";var t={},e={};ViewModel.tmpl={setRawTemplate:function(e,n){t[e]=n},getRawTemplate:function(e){return t[e]},get:function(n,i){var r,s=e[n];if(!s){if(r=t[n],void 0===r)throw Error('Raw template: "'+n+'" is not defined');e[n]=s=i(r)}return s}},ViewModel.binds.template=function(n,i,r,s){var o=$(n),c=i.split(/\s*,\s*/),u=c[0],a=c[1];return t[u]=o.html(),o.remove(),a&&(a=this.evil(a,r,s),e[u]=a(t[u])),!1}}(),function(){"use strict";var t=function(t,e,n,i,r){var s,o,c={};i.$parent=n,i.$self=Computed({initial:e.value,$el:t});var u=function(e){if(i.$self(e),s&&s.off(0,0,r),e)_.extend(c,e.attributes),e.on("change",function(e){_.extend(c,e),t.refreshBinds()},r);else for(o in c)delete c[o];t.refreshBinds(),s=e};return u(e.value),e.subscribe(u),t.each(function(){ViewModel.findBinds(this,c,i)}),i};ViewModel.binds.withModel=function(e,n,i,r){return r=r||{},t(e.children(),this.findObservable(n,i,r,e),i,r,{}),!1},ViewModel.binds.eachModel=function(e,n,i,r){var s,o,c,u,a,l=e[0],f={},h=l.tagName.toLowerCase();return s=n.split(/\s*,\s*/),o=s[0],c=s[1],a=c?"":e.html(),this.findObservable(o,i,r,e).callAndSubscribe(function(n){u&&(u.off(0,0,f),u.each(function(t){t.off(0,0,f)})),u=n,e.empty();var i,r,s,o;n&&(i=1,r=function(e){return function(r,s){var o,c,u=document.createElement(h);try{u.innerHTML=e}catch(a){console.log(a)}return c=$(u).children(),o=t(c,Computed({initial:r,$el:c}).obj,n,{$index:s},f),i=c.length,c}},s=c?ViewModel.tmpl.get(c,r):r(a),o=function(){var t=n.getIndex(n.at(0))-1;e.children().clearBinds(),e.empty(),0>t&&(t=0),n.each(function(i){e.append(s(i,t++,n))})},o(),n.on("add",function(t,r,o){var c=0,u="",a=o||r;u=$(document.createElement(h)),_.each(t,function(t){u.append(s(t,a+c++,n))}),u=u.children(),0===r?e.prepend(u):r&&r!==n.length-t.length?e.children().eq(r*i).before(u):e.append(u)},f),n.on("beforeReset",function(t){_.each(t,function(t){t.off(0,0,f)})},f),n.on("reset",o,f),n.on("cut",function(t){var n=e.children();_.each(t,function(t,e){e*=1,t.off(0,0,f),n.slice(e,e+i).clearBinds().empty().remove()})},f),n.on("sort",function(t){var n=$(document.createElement("div")),r=e.children();_.each(t,function(t,e){e*=1,n.append(r.slice(e,e+i))}),e.append(n.children())},f))}),!1}}();