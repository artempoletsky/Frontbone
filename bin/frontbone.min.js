(function(){var e=function(){},t=function(){},n=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;t.prototype._constructor=Object,t.prototype.constructor=t,t.extend=function(t){var r=this,i=function(){this._constructor.apply(this,arguments)};return t.hasOwnProperty("constructor")&&(t._constructor=t.constructor),e.prototype=r.prototype,i.prototype=new e,_.each(t,function(e,t){i.prototype[t]=typeof e=="function"&&typeof e.prototype._constructor=="undefined"&&e._notSimple===undefined&&n.test(e.toString())?function(e,t){return function(){var n=this._super;this._super=r.prototype[e];var i=t.apply(this,arguments);return this._super=n,i}}(t,e):e}),i.prototype.constructor=i,i.extend=r.extend,i.create=r.create,i},t.create=function(e){var t=_.toArray(arguments);t.shift();var n=this.extend(e),r="return new child(",i=t.length,s=["child"],o=[n];if(i>0){for(var u=0;u<i;u++)r+="arg"+u+", ",s.push("arg"+u),o.push(t[u]);r=r.substr(0,r.length-2)}r+=");",s.push(r);var a;try{a=Function.apply(undefined,s).apply(undefined,o)}catch(f){throw f}return a},this.Class=t})(),function(){function n(e){var n=(""+e).split(t);return{n:n[0],ns:n.slice(1),o:e}}function r(e,t){for(var n=e.length-1;n>=0;n--)if(!~t.indexOf(e[n]))return!1;return!0}function i(e,t,n){return e.n&&e.n!=t.n?!1:e.fn&&e.fn!==t.fn?!1:e.c&&e.c!==t.c?!1:e.ns.length&&!r(e.ns,t.ns)?!1:!0}function s(e,t,r,i){var s=n(e);return s.fn=t,s.c=r,s.s=i,s}function o(e,t){var n,r;n=e._listeners||{},r=n[t.n]||[],r.push(t),n[t.n]=r,e._listeners=n}var e=/\s+/,t=".";Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){return _.indexOf(this,e,t)});var u=function(e,t,n,r,o){var u=[],a,f,l=s(t,n,r);o||(o="filter");for(a in e)for(f=e[a].length-1;f>=0;f--)if(i(l,e[a][f])){if(o=="filter")u.push(e[a][f]);else if(o=="any")return!0}else o=="invert"&&u.push(e[a][f]);return o!="any"?u:!1},a=function(e,t,n){var r,i,a;if(!this._listeners)return;if(!e&&!t&&!n){delete this._listeners;return}r=s(e,t,n);if(!r.ns.length&&!t&&!n){delete this._listeners[r.n];return}i=u(this._listeners,e,t,n,"invert"),delete this._listeners;for(a=i.length-1;a>=0;a--)o(this,i[a])},f=Class.extend({on:function(t,n,r){var i=t.split(e),u,a;if(typeof n!="function")throw TypeError("function expected");r||(r=this);for(u=i.length-1;u>=0;u--)a=s(i[u],n,r),o(this,a);return this},off:function(t,n,r){if(!t)return a.call(this,"",n,r),this;var i=t.split(e),s,o;for(s=0,o=i.length;s<o;s++)a.call(this,i[s],n,r);return this},fire:function(t){if(!this._listeners)return this;var n=Array.prototype.slice.call(arguments,1),r,i,s,o,a,f,l;r=typeof t=="string"?t.split(e):[t];for(i=0,o=r.length;i<o;i++){l=typeof r[i]=="string"?r[i]:r[i].type,a=u(this._listeners,l,!1,!1);for(s=a.length-1;s>=0;s--)f=a[s],f.s&&this.off(undefined,f.fn),f.fn.apply(f.c,n)}return this},one:function(t,n,r){var i=t.split(e),u,a;if(typeof n!="function")throw TypeError("function expected");r||(r=this);for(u=i.length-1;u>=0;u--)a=s(i[u],n,r,!0),o(this,a);return this},hasListener:function(e){return this._listeners?u(this._listeners,e,!1,!1,"any"):!1}});f.prototype.trigger=f.prototype.fire,this.Events=f}(),function(){var e={},t=Events.extend({constructor:function(t){t||(t={}),this.attributes=_.extend({},this.defaults,this.parse(t)),this._changed={},this.id=this.attributes[this.idAttribute],this.cid=_.uniqueId("c"),this.mapping&&this.id&&(e[this.mapping]||(e[this.mapping]={}),e[this.mapping][this.id]=this),this.initialize()},initialize:function(){return this},idAttribute:"id",mapping:!1,defaults:{},toJSON:function(){return _.clone(this.attributes)},parse:function(e){return e},baseURL:"/",url:function(){var e=this.mapping?this.mapping+"/":"",t=this.id?this.id+"/":"";return this.baseURL+e+t},update:function(e){return this.prop(this.parse(e)),this._changed={},this},prop:function(e){if(arguments.length==1&&typeof e=="string")return this.attributes[e];var t={};typeof e=="string"?t[e]=arguments[1]:t=e;var n=this;return _.each(t,function(e,t){n._changed[t]=n.attributes[t]=e,t==n.idAttribute&&(n.id=e),n.fire("change:"+t)}),this.fire("change"),this},get:function(e){return this.prop.apply(this,arguments)},set:function(){return this.prop.apply(this,arguments)},validate:function(){return!0},fetch:function(e){var n=this;e||(e={});var r={success:function(t){n.update(t),typeof e.success=="function"&&e.success.apply(n,arguments)},error:function(){typeof e.error=="function"&&e.error.apply(n,arguments)}},i=_.extend({},e,r);return t.sync("read",this.url(),i),this},save:function(){var e=this;if(!this.validate())throw new Error("Model is invalid");if(this.id){if(_.keys(e._changed).length==0)return this;t.sync("update",this.url(),{data:e._changed,success:function(t){e.update(t)}})}else t.sync("create",this.url(),{data:_.clone(this.attributes),success:function(t){e.update(t)}});return this},remove:function(){this.fire("remove"),this.id&&t.sync("delete",this.url(),{})}});t.fromStorage=function(t,n){return e[t]||(e[t]={}),e[t][n]},t.createOrUpdate=function(e,n){var r=e.prototype,i,s,o,u;if(r.mapping){s=r.idAttribute,o=r.parse(n),i=t.fromStorage(r.mapping,o[s]);if(i)return i.update(n),i}return new e(n)},t.sync=function(e,t,n){n||(n={});var r={method:e};e=="PUT"&&(e="POST"),$.extend(r,n.data),$.ajax({url:t,dataType:"json",type:e,data:r,success:n.success,error:n.error})},this.Model=t}(),function(){var e=function(e){this.self=e},t=Model.extend({constructor:function(t,n){this.itself=new e(this),this.models=[],this.length=0,t&&t.length&&this.reset(t),this.initialize()},models:[],model:Model,url:function(){return this.baseURL+this.model.prototype.mapping+"/"},fetch:function(e){var t=this;e||(e={});var n={success:function(n){t.reset(n,e),typeof e.success=="function"&&e.success.apply(t,arguments)},error:function(){typeof e.error=="function"&&e.error.apply(t,arguments)}},r=_.extend({},e,n);Model.sync("GET",this.url(),r)},reset:function(e,t){t||(t={}),t.add||(this.models=[],this.length=0);if(!e){this.fire("reset");return}var n=this.parse(e);if(n instanceof Array){for(var r=0,i=n.length;r<i;r++)this.add(n[r],"end",!0);t.add?this.fire("add",n,0):this.fire("reset")}else this.add(n,"end",!0),t.add?this.fire("add",[n],0):this.fire("reset")},push:function(e){return this.add(e)},unshift:function(e){return this.add(e,0)},add:function(e,t,n){typeof t=="number"||(t=this.length),e instanceof Model||(e=Model.createOrUpdate(this.model,e));var r=this;return e.one("remove",function(){r.cutByCid(this.cid)}),this.models.splice(t,0,e),this.length=this.models.length,n||this.fire("add",[e],t),this},cut:function(e){var t;return this.each(function(n,r){if(n.id==e)return t=this.cutAt(r),!1}),t},cutByCid:function(e){var t,n=this;return this.each(function(r,i){if(r.cid==e)return t=n.cutAt(i),!1}),t},shift:function(){return this.cutAt(0)},pop:function(){return this.cutAt()},cutAt:function(e){e!==undefined||(e=this.models.length-1);var t=this.models.splice(e,1)[0];return this.length=this.models.length,this.fire("cut",t,e),t},at:function(e){return this.models[e]},get:function(){return this.getByID.apply(this,arguments)},getByID:function(e){var t;return this.each(function(n){if(n.id==e)return t=n,!1}),t},getByCid:function(e){var t;return this.each(function(n){if(n.cid==e)return t=n,!1}),t}}),n=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortByDesc","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"],r=function(e){return _.isFunction(e)?e:function(t){return t[e]}};_.sortByDesc=function(e,t,n){var i=r(t);return _.pluck(_.map(e,function(e,t,r){return{value:e,index:t,criteria:i.call(n,e,t,r)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return-1;if(n<r||r===void 0)return 1}return e.index<t.index?-1:1}),"value")},_.each(n,function(e){t.prototype[e]=function(){return _[e].apply(_,[this.models].concat(_.toArray(arguments)))}});var i=["filter","reject"],s=["sortBy","sortByDesc","shuffle"];_.each(i,function(t){e.prototype[t]=function(){var e=t=="filter"?"reject":"filter",n=this.self,r=_[t].apply(_,[n.models].concat(_.toArray(arguments))),i=_[e].apply(_,[n.models].concat(_.toArray(arguments))),s={};return _.each(i,function(e){s[n.indexOf(e)]=e}),n.models=r,n.length=r.length,n.fire("reject",s),n}}),_.each(s,function(t){e.prototype[t]=function(){var e=this.self,n=_[t].apply(_,[e.models].concat(_.toArray(arguments))),r={};return _.each(n,function(t,n){r[e.indexOf(t)]=n}),e.models=n,e.length=n.length,e.fire("sort",r),e}}),this.Collection=t}(),function(){(function(){var e=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(){var e=[],t=!1;return function(n){e.push(n),t||setTimeout(function(){_.each(e,function(e){e()}),e=[],t=!1},1e3/60)}}();window.requestAnimationFrame=e})();var e=function(e){return e._listeners=[],e.subscribe=function(t){e._listeners.push(t)},e.unsubscribe=function(t){for(var n=0,r=e._listeners.length;n<r;n++)e._listeners[n]===t&&e._listeners.splice(n,1)},e.fire=function(){for(var t=0,n=e._listeners.length;t<n;t++)e._listeners[t].call(e)},e._notSimple=!0,e},t=!1,n=function(n){var r=n,i=function(e){if(arguments.length>0){if(r!==e||_.isObject(e))i.lastValue=r,r=e,i.fire()}else t&&t.subscribeTo(i);return r};return e(i),i.lastValue=undefined,i.valueOf=i.toString=function(){return this()},i.__observable=!0,i};n.isObservable=function(e){return typeof e!="function"?!1:e.__observable||!1};var r=function(n){var r,i,s,o;typeof n=="function"?(r=n,i=arguments[1],s=arguments[2],o=arguments[3]):(r=n.get,i=n.context,s=n.async,o=n.set);var u=r.call(i),a=function(){return arguments.length==1&&o.call(i,arguments[0]),t&&t.subscribeTo(a),u},f=!1;return a.async=s||!1,a.subscribeTo=function(e){e.subscribe(function(){a.refresh(),a.async?f||(f=!0,window.requestAnimationFrame(function(){a.fire(),f=!1})):a.fire()})},e(a),a.refresh=function(){u=r.call(i)},a.__observable=!0,a.valueOf=a.toString=function(){return this()},t=a,r.call(i),t=!1,a};this.Observable=n,this.Computed=r,this.Subscribeable=e}(),function(){var e=this.$,t=/\s+/,n=/\s*;\s*/,r=/^[a-z]+$/,i={setElement:function(t){return this.undelegateEvents(),this.el=t,this.$el=e(t),this.parse().delegateEvents(),this},constructor:function(t){t||(t={}),this.options=t,t.collection&&(this.collection=t.collection),this.model=t.model,t.el&&(this.el=t.el);var n=this;n._cid||(n._cid=_.uniqueId("vm")),n.el||(n.el="div"),typeof n.el=="string"&&(r.test(n.el)&&n.el!="html"&&n.el!="body"?n.el=document.createElement(n.el):n.el=e(n.el)[0]),n.$el=e(n.el),n.$=function(e){return n.$el.find(e)},n.initialize(),n.autoinit&&n.parse(),n.delegateEvents()},remove:function(){return this.$el.remove(),this},parse:function(){return i.findBinds(this.el,this),this},bindToModel:function(e){var t=Observable(new Model(e)),n=t(),r=!0,i={},s=function(e){n&&n.off(0,0,i),n=e,e&&e.on("change",function(){r=!1,t.fire(),r=!0},i)};s(n),t.subscribe(function(){r&&s(this())});if(!this._bindedToModel)for(var o in n.attributes)this[o]=function(e,n){return Computed(function(){var n=t();return n?this["format_"+e]?this["format_"+e](n.get(e)):n.get(e):""},n)}(o,this);return this._bindedToModel=!0,t},autoinit:!1,initialize:function(){},delegateEvents:function(e){e||(e=this.events),this.undelegateEvents();var n,r,i,s,o,u=this;for(i in e){n=e[i],r=typeof n=="function"?n:u[n]||Function("return "+n)();if(typeof r!="function")throw TypeError(n+" is not a function");s=i.split(t),o=s.shift().split(",").join("."+u._cid+" ")+"."+u._cid;var a=function(e){return function(){e.apply(u,arguments)}}(r);s.length?u.$el.delegate(s.join(" "),o,a):u.$el.bind(o,a)}return this},undelegateEvents:function(){return this.$el.unbind("."+this._cid),this},render:function(){return this}};i=Events.extend(i),i.compAsync=!1,i.findObservable=function(e,t,n){n||(n={}),Observable.isObservable(e)&&(e=e());var r=_.keys(n),s=[];for(var o=0;o<r.length;o++)s[o]=n[r[o]];r.push("with(this) return "+t+"");var u=function(){try{return Function.apply(e,r).apply(e,s)}catch(n){console.log('Error "'+n.message+'" in expression "'+t+'" Context: ',e)}},a,f=u();return i.compAsync?Observable.isObservable(f)?a=Computed(function(){return f()},e,!0):a=Computed(function(){return u()},e,!0):Observable.isObservable(f)?a=f:a=Computed(function(){return u()},e),a},i.findBinds=function(t,r,s){var o,u,a,f,l,c;u=e(t).attr("data-bind"),e(t).removeAttr("data-bind");if(u){a=u.split(n);for(f=0,c=a.length;f<c;f++){if(!a[f])continue;var h=a[f].match(/^\s*(\S+)\s*:\s*(\S[\s\S]*\S)\s*$/);h||(h=[a[f],a[f],""]);var p=i.binds[h[1]];if(p){l=p.call(this,t,h[2],r,s);if(l===!1)return;l&&(r=l)}}}if(t){o=t.childNodes;if(o)for(f=0,c=o.length;f<c;f++)i.findBinds(o[f],r,s)}},this.ViewModel=i}(),function(){ViewModel.binds={log:function(e,t,n,r){var i=this.findObservable(n,t,r);console.log(n,".",t,"=",i())},html:function(e,t,n,r){var i=this.findObservable(n,t,r),s=function(){$(e).html(i())};s(),i.subscribe(s)},text:function(e,t,n,r){var i=this.findObservable(n,t,r),s=function(){$(e).text(i())};s(),i.subscribe(s)},"with":function(e,t,n,r){return this.findObservable(n,t,r)()},each:function(e,t,n,r){var i=this.findObservable(n,t,r),s=$(e),o=s.html();s.hide().empty(),r||(r={});var u=function(){s.hide().empty();var t=i();t&&$.each(t,function(n,i){r.$index=n,r.$parent=t,r.$value=i;var s=document.createElement("div");$(s).html(o),ViewModel.findBinds(s,i,r);var u=$(s).children();u.appendTo(e)}),s.show()};return u(),i.subscribe(u),!1},eachModel:function(e,t,n,r){var i=this.findObservable(n,t,r),s=$(e).html(),o=function(t){var n=0;r||(r={});var i=function(i,o){var u=document.createElement("div");$(u).html(s);var a=Observable(i);r.$index=o,r.$parent=t,ViewModel.findBinds(u,a,r);var f=$(u).children();o==0?f.prependTo(e):f.length&&$(e).children().eq(o*f.length).length?f.insertBefore($(e).children().eq(o*f.length)):f.appendTo(e);var l={};i.on("change",function(e){a.fire()},l).on("cut",function(e){e===t&&(f.empty().remove(),t.fire("cut",i)),i.off(0,0,l),a.destroy(),delete a},l),n++};t.length&&t.each(i),t.on("add",i),$(e).show()},u=function(){$(e).hide(),$(e).empty();var t=i();t&&o(t)};return u(),i.subscribe(u),!1},value:function(e,t,n,r){var i=ViewModel.findObservable(n,t,r),s=function(){$(e).val(i())};s(),i.subscribe(s)},attr:function(e,t,n,r){t=t.match(/^{([\s\S]+)}$/)[1];var i=t.split(/\s*,\s*/);for(var s=i.length-1;s>=0;s--){var o=i[s].match(/^\s*(\S+?)\s*:\s*(\S[\s\S]*\S)\s*$/),u=ViewModel.findObservable(n,o[2],r);(function(e,t,n){var r=function(){$(e).attr(t,n())};r(),n.subscribe(r)})(e,o[1],u)}},style:function(e,t,n,r){t=t.match(/^{([\s\S]+)}$/)[1];var i=t.split(/\s*,\s*/);for(var s=i.length-1;s>=0;s--){var o=i[s].match(/^\s*(\S+?)\s*:\s*(\S[\s\S]*\S)\s*$/),u=ViewModel.findObservable(n,o[2],r);(function(e,t,n){var r=function(){$(e).css(t,n())};r(),n.subscribe(r)})(e,o[1],u)}},css:function(e,t,n,r){t=t.match(/^{([\s\S]+)}$/)[1];var i=t.split(/\s*,\s*/);for(var s=i.length-1;s>=0;s--){var o=i[s].match(/^\s*(\S+?)\s*:\s*(\S[\s\S]*\S)\s*$/);(function(t,i){var s=ViewModel.findObservable(n,t,r),o=function(){s()?$(e).addClass(i):$(e).removeClass(i)};o(),s.subscribe(o)})(o[2],o[1])}},display:function(e,t,n,r){var i=this.findObservable(n,t,r),s=function(){i()?$(e).show():$(e).hide()};s(),i.subscribe(s)},click:function(e,t,n,r){var i=this.findObservable(n,t,r)(),s=$(e);s.click(function(){i.apply(n,arguments)})}}}();