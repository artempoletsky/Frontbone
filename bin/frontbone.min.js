(function(undefined){(function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(e){"use strict";if(this==null)throw new TypeError;var t=Object(this),n=t.length>>>0;if(n===0)return-1;var r=0;arguments.length>1&&(r=Number(arguments[1]),r!=r?r=0:r!=0&&r!=Infinity&&r!=-Infinity&&(r=(r>0||-1)*Math.floor(Math.abs(r))));if(r>=n)return-1;var i=r>=0?r:Math.max(n-Math.abs(r),0);for(;i<n;i++)if(i in t&&t[i]===e)return i;return-1})})(),function(){var e=function(e,t){for(var n in t)ob2.hasOwnProperty(n)&&(e[n]=t[n])},t={},n={extend:function(){var t;for(t=arguments.lengthi;t>0;t--)e(arguments[0],arguments[t]);return arguments[0]},keys:function(e){var t=[];for(var n in e)t.push(n);return t},unique:function(e){return e=""+e,t[e]||(t[e]=0),t[e]++,e+t[e]},sync:function(e,t,n){n||(n={});var r={method:e};e=="PUT"&&(e="POST"),$.extend(r,n.data),$.ajax({url:t+"&"+Math.random(),dataType:"json",type:e,data:r,success:n.success,error:n.error})}};this.VM=n}.call(this),function(){function r(e){var t=(""+e).split(n);return{n:t[0],ns:t.slice(1),o:e}}function i(e,t){for(var n=e.length-1;n>=0;n--)if(!~t.indexOf(e[n]))return!1;return!0}function s(e,t,n){return e.n&&e.n!=t.n?!1:e.fn&&e.fn!==t.fn?!1:e.c&&e.c!==t.c?!1:e.ns.length&&!i(e.ns,t.ns)?!1:!0}function o(e,t,n){var i=r(e);return i.fn=t,i.c=n,i}function u(e,t){var n,r;n=e._listeners||{},r=n[t.n]||[],r.push(t),n[t.n]=r,e._listeners=n}function a(e,t,n,r,i){var u=[],a,f,l=o(t,n,r);i||(i="filter");for(a in e)for(f=e[a].length-1;f>=0;f--)if(s(l,e[a][f])){if(i=="filter")u.push(e[a][f]);else if(i=="any")return!0}else i=="invert"&&u.push(e[a][f]);return i!="any"?u:!1}function f(e,t,n){var r,i,s;if(!this._listeners)return;if(!e&&!t&&!n){delete this._listeners;return}r=o(e,t,n);if(!r.ns.length&&!t&&!n){delete this._listeners[r.n];return}i=a(this._listeners,e,t,n,"invert"),delete this._listeners;for(s=i.length-1;s>=0;s--)u(this,i[s])}var e=function(){},t=/\s+/,n=".";e.prototype.on=function(e,n,r){var i=e.split(t),s,a;if(typeof n!="function")throw TypeError("function expected");r||(r=this);for(s=i.length-1;s>=0;s--)a=o(i[s],n,r),u(this,a);return this},e.prototype.off=function(e,n,r){if(!e)return f.call(this,"",n,r),this;var i=e.split(t),s,o;for(s=0,o=i.length;s<o;s++)f.call(this,i[s],n,r);return this},e.prototype.fire=function(e){if(!this._listeners)return this;var n,r,i,s,o,u,f;n=typeof e=="string"?e.split(t):[e];for(r=0,s=n.length;r<s;r++){f=typeof n[r]=="string"?n[r]:n[r].type,o=a(this._listeners,f,!1,!1);for(i=o.length-1;i>=0;i--)u=o[i],u.fn.call(u.c,n[r])}return this},e.prototype.one=function(e,t,n){var r=function(){this.off(e,r,n),t.apply(this,arguments)};return this.on(e,r,n)},e.prototype.hasListener=function(e){return this._listeners?a(this._listeners,e,!1,!1,"any"):!1},this.Events=e}.call(this),function(){function e(){for(var e=arguments.length-1;e>=0;e--)if(arguments[e]!==Object(arguments[e]))return!1;return!0}function t(n,r){if(n===r)return!0;var i={},s=!1;if(!e(n,r))return!1;for(var o in n)if(n.hasOwnProperty(o)){i[o]=!0,s=!0;if(!t(n[o],r[o]))return!1}for(o in r){if(i[o])continue;if(r.hasOwnProperty(o)){s=!0;if(!t(n[o],r[o]))return!1}}return s?!0:!0}var n=function(e){return e._listeners=[],e.subscribe=function(t){e._listeners.push(t)},e.unsubscribe=function(t){for(var n=0,r=e._listeners.length;n<r;n++)e._listeners[n]===t&&e._listeners.splice(n,1)},e.fire=function(){for(var t=0,n=e._listeners.length;t<n;t++)e._listeners[t].call(e)},e},r=!1,i=function(e){var i=e,s=function(e){return arguments.length>0?t(e,i)||(s.lastValue=i,i=e,s.fire()):r&&function(e){s.subscribe(function(){e.refresh(),e.fire()})}(r),i};return s.lastValue=undefined,s.valueOf=s.toString=function(){return this()},n(s),s.__observable=!0,s};i.isObservable=function(e){return typeof e!="function"?!1:e.__observable||!1};var s=function(e,t){var i=e.call(t),s=function(){return r&&function(e){s.subscribe(function(){e.refresh(),e.fire()})}(r),i};return r=s,e.call(t),r=!1,n(s),s.refresh=function(){i=e.call(t)},s.__observable=!0,s.valueOf=s.toString=function(){return this()},s};this.Observable=i,this.Computed=s,this.Subscribeable=n}.call(this),function(){function findBinds(e,t,n){ViewModel.findBinds(e,t,n)}function ViewModel(){this._construct()}var $=this.$,eventSplitter=/\s+/,bindSplitter=/\s*;\s*/,simpleTagRegex=/^[a-z]+$/;ViewModel.findObservable=function(context,string){var comp=Computed(function(){try{with(Observable.isObservable(context)?context():context)return eval(string)}catch(exception){throw'Error "'+exception.message+'" in expression "'+string+'"'}},context);return comp},ViewModel.findBinds=function(e,t){var n,r,i,s,o;r=e.attributes&&e.attributes["data-bind"];if(r){i=r.value.split(bindSplitter);for(s=i.length-1;s>=0;s--){var u=i[s].match(/^\s*(\S+?)\s*:\s*(\S[\s\S]*\S)\s*$/),a=ViewModel.binds[u[1]];if(a){o=a.call(this,e,u[2],t);if(o===!1)return;o&&(t=o)}}}n=e.childNodes;if(n)for(s=n.length-1;s>=0;s--)findBinds(n[s],t)},ViewModel.create=function(e){var t={};return $.extend(t,ViewModel.prototype,e),t._construct()},ViewModel.prototype=new Events,ViewModel.prototype.addBind=function(e,t,n){var r,i;return r=this._binds||(this._binds={}),i=r[e]||(r[e]=[]),i.push({el:t,val:n}),this},ViewModel.prototype.setElement=function(e){return this.undelegateEvents(),this.el=e,this.$el=$(e),this.parse().delegateEvents(),this},ViewModel.prototype.parse=function(){delete this._binds,findBinds(this.el,this,"");return this;var e,t,n,r,i,s},ViewModel.prototype._construct=function(){var e=this;return e._cid||(e._cid=VM.unique("vm")),e.el||(e.el="div"),typeof e.el=="string"&&(simpleTagRegex.test(e.el)?e.el=document.createElement(e.el):e.el=$(e.el)[0]),e.$el=$(e.el),e.$=function(t){return e.$el.find(t)},e.initialize(),e.autoinit&&e.parse().delegateEvents(),this},ViewModel.prototype.autoinit=!0,ViewModel.prototype.initialize=function(){},ViewModel.prototype.delegateEvents=function(e){e||(e=this.events),this.undelegateEvents();var t,n,r,i,s,o=this;for(r in e){t=e[r],n=o[t];if(typeof n!="function")throw TypeError(t+" is not a function");i=r.split(eventSplitter),s=i.shift()+"."+this._cid;var u=function(e){return function(){e.apply(o,arguments)}}(n);i.length?o.$el.delegate(i.join(" "),s,u):o.$el.bind(s,u)}return this},ViewModel.prototype.undelegateEvents=function(){return this.$el.unbind("."+this._cid),this},ViewModel.prototype.render=function(){return this},this.ViewModel=ViewModel}.call(this),function(){function t(t,n){t||(t={}),n||(n={}),this.attributes=this.parse(t),this.id=this.attributes[this.idAttribute],this.cid=VM.unique("c"),this.mapping&&this.id&&(e[this.mapping]||(e[this.mapping]={}),e[this.mapping][this.id]=this),this.url="api/?model="+this.mapping+"&id="+this.id,this.initialize()}var e={};t.extend=function(e){var t=this.prototype.constructor,n=function(e,n){t.call(this,e,n)};n.prototype=new t,n.prototype.constructor=n;for(var r in e)n.prototype[r]=e[r];return n.extend=t.extend,n},t.prototype=new Events,t.prototype.constructor=t,t.prototype.idAttribute="id",t.prototype.mapping=!1,t.prototype.initialize=function(){return this},t.prototype.parse=function(e){return e},t.prototype.update=function(e){this.set(this.parse(e))},t.prototype.get=function(e){return this.attributes[e]},t.prototype.validate=function(){return!0},t.prototype.save=function(){var e=this;return this.id?VM.sync("PUT",this.url,{data:this.attributes}):VM.sync("POST",this.url,{data:this.attributes,success:function(t){e.set("id",t),e.id=t}}),!0},t.prototype.remove=function(){this.fire("remove"),this.id&&VM.sync("DELETE",this.url)},t.prototype.set=function(e,t){var n={},r;arguments.length>1?n[e]=t:n=e;var i={};for(r in n)this.attributes[r]=n[r],i[r]=n[r],this.fire("change:"+r);return this.fire({type:"change",changed:i}),this},t.fromStorage=function(t,n){return e[t]||(e[t]={}),e[t][n]},t.createOrUpdate=function(e,n){var r=e.prototype,i,s,o,u;if(r.mapping){s=r.idAttribute,o=r.parse(n),i=t.fromStorage(r.mapping,o[s]);if(i)return i.update(n),i}return new e(n)},this.Model=t}(),function(){function e(e){this.models=[],this.length=0,this.url="api/?model="+this.model.prototype.mapping,e&&this.reset(e),this.initialize()}(function(e){e.prototype=new Events,e.prototype.constructor=e,e.extend=Model.extend,e.prototype.model=Model,e.prototype.initialize=function(){return this},e.prototype.fetch=function(e){var t=this;e||(e={});var n={success:function(n){t.reset(n,e),typeof e.success=="function"&&e.success.apply(t,arguments)},error:function(){typeof e.error=="function"&&e.error.apply(t,arguments)}},r={};$.extend(r,e,n),VM.sync("GET",this.url,r)},e.prototype.parse=function(e){return e},e.prototype.reset=function(e,t){t||(t={}),t.add||(this.models=[]);var n=this.parse(e);if(n instanceof Array)for(var r=0,i=n.length;r<i;r++)this.add(n[r]);else this.add(n);t.add?this.fire("addScope"):this.fire("reset")},e.prototype.add=function(e){e instanceof Model||(e=Model.createOrUpdate(this.model,e));var t=this;e.one("remove",function(){t.cutByCid(this.cid)}),this.models.push(e),this.fire({type:"add",model:e})},e.prototype.cut=function(e){var t;return this.each(function(n,r){if(n.id==e)return t=this.cutAt(r),!1}),t},e.prototype.cutByCid=function(e){var t;return this.each(function(n,r){if(n.cid==e)return t=this.cutAt(r),!1}),t},e.prototype.cutAt=function(e){var t=this.models.splice(e,1)[0];return this.fire({type:"cut",model:t}),t},e.prototype.at=function(e){return this.models[e]},e.prototype.each=function(e){var t;for(var n=0,r=this.models.length;n<r;n++){t=e.call(this,this.models[n],n);if(t===!1)break}return this},e.prototype.get=function(e){var t;return this.each(function(n){if(n.id==e)return t=n,!1}),t},e.prototype.getByCid=function(e){var t;return this.each(function(n){if(n.cid==e)return t=n,!1}),t},e.prototype.remove=function(e){var t=this.cut(e)}})(e),this.Collection=e}(),function(){ViewModel.binds={html:function(e,t,n){var r=ViewModel.findObservable(n,t),i=function(){$(e).html(r())};i(),r.subscribe(i)},"with":function(e,t,n){var r=ViewModel.findObservable(n,t);return r()},each:function(e,t,n){var r=ViewModel.findObservable(n,t)(),i=$(e).html();return $(e).empty(),r.on("add",function(t){var n=document.createElement("div");$(n).html(i);var r=Observable(t.model);ViewModel.findBinds(n,r);var s=$(n).children();s.appendTo(e),t.model.one("remove",function(){s.remove()}).on("change",function(e){r.fire()})}),!1},value:function(e,t,n){var r=ViewModel.findObservable(n,t),i=function(){$(e).val(r())};i(),r.subscribe(i)},attr:function(e,t,n){t=t.match(/^{([\s\S]+)}$/)[1];var r=t.split(/\s*,\s*/);for(var i=r.length-1;i>=0;i--){var s=r[i].match(/^\s*(\S+?)\s*:\s*(\S[\s\S]*\S)\s*$/),o=ViewModel.findObservable(n,s[2]),u=function(){$(e).attr(s[1],o())};u(),o.subscribe(u)}},style:function(e,t,n){t=t.match(/^{([\s\S]+)}$/)[1];var r=t.split(/\s*,\s*/);for(var i=r.length-1;i>=0;i--){var s=r[i].match(/^\s*(\S+?)\s*:\s*(\S[\s\S]*\S)\s*$/),o=ViewModel.findObservable(n,s[2]),u=function(){$(e).css(s[1],o())};u(),o.subscribe(u)}},css:function(e,t,n){t=t.match(/^{([\s\S]+)}$/)[1];var r=t.split(/\s*,\s*/);for(var i=r.length-1;i>=0;i--){var s=r[i].match(/^\s*(\S+?)\s*:\s*(\S[\s\S]*\S)\s*$/),o=ViewModel.findObservable(n,s[2]),u=function(){o()?$(e).addClass(s[1]):$(e).removeClass(s[1])};u(),o.subscribe(u)}}}}()})(undefined)