/*! frontbone 2013-03-09 */
(function(){var t=[],e=!1,n=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(t){setTimeout(function(){t()},1e3/15)};window.ComputedRefresher={refreshAll:function(){_.each(t,function(t){t.refresh()}),t=[]},startRefresh:function(){var t=this;e=!0,n(function(){e&&(t.refreshAll(),t.startRefresh())})},stopRefresh:function(){e=!1}},ComputedRefresher.startRefresh();var i=function(t){return t._listeners=[],t.subscribe=function(){t._listeners.push(arguments)},t.unsubscribe=function(e){for(var n=0,i=t._listeners.length;i>n;n++)t._listeners[n][0]===e&&t._listeners.splice(n,1)},t.fire=function(){for(var e=0,n=t._listeners.length;n>e;e++)t._listeners[e][0].call(t._listeners[e][1]||t,t())},t.callAndSubscribe=function(e){e.call(this,t()),this.subscribe(e)},t._notSimple=!0,t},r=!1,s=function(t){var e=t,n=function(t){return arguments.length>0?(e!==t||_.isObject(t))&&(n.lastValue=e,e=t,n.fire()):r&&r.subscribeTo(n),e};return i(n),n.lastValue=void 0,n.valueOf=n.toString=function(){return this()},n.__observable=!0,n};s.isObservable=function(t){return"function"!=typeof t?!1:t.__observable||!1};var o=function(e){var n,s,o,u;"function"==typeof e?(n=e,s=arguments[1],o=arguments[2],u=arguments[3]):(n=e.get,s=e.context,o=e.async,u=e.set);var c=function(){if(1==arguments.length){if(!u)throw Error("Setter for computed is not defined");u.call(s,arguments[0])}return n.call(s)},a=function(){o?t.push(c):c.refresh()};c.async=o||!1;var f=[];c.subscribeTo=function(t){~f.indexOf(t)||(f.push(t),t.subscribe(a))},i(c),c.__observable=!0,c.valueOf=c.toString=function(){return this()},r=c;var h=n.call(s);return r=!1,c.refresh=function(){var t=this();(h!==t||_.isObject(t))&&this.fire(),h=t},delete f,delete c.subscribeTo,c};this.Observable=s,this.Computed=o,this.Subscribeable=i})(),function(t){"use strict";var e=function(){},n=function(){},i=/xyz/.test(function(){alert("xyz")})?/\b_super\b/:/.*/;n.prototype._constructor=Object,n.prototype.constructor=n,n.extend=function(t){var n=this,r=function(){this._constructor.apply(this,arguments)};return t.hasOwnProperty("constructor")&&(t._constructor=t.constructor),e.prototype=n.prototype,r.prototype=new e,_.each(t,function(t,e){r.prototype[e]="function"==typeof t&&void 0===t._notSimple&&i.test(""+t)?function(){var i,r=this._super;return this._super=n.prototype[e],i=t.apply(this,arguments),this._super=r,i}:t}),r.prototype.constructor=r,r.extend=n.extend,r.create=n.create,r},n.create=function(t){var e,n,i,r=_.toArray(arguments),s=this.extend(t),o="return new child(",u=["child"],c=[s];if(r.shift(),e=r.length,e>0){for(n=0;e>n;n++)o+="arg"+n+", ",u.push("arg"+n),c.push(r[n]);o=o.substr(0,o.length-2)}o+=");",u.push(o);try{i=Function.apply(void 0,u).apply(void 0,c)}catch(a){throw a}return i},t.Class=n}(this),function(t){"use strict";Array.prototype.indexOf||(Array.prototype.indexOf=function(t,e){return _.indexOf(this,t,e)});var e=/\s+/,n=".",i=function(t,e,i,r){t+="";var s=t.split(n);return{c:i,s:r,fn:e,n:s[0],ns:s.slice(1),o:t}},r=function(t,e){var n,i;n=t._listeners||{},i=n[e.n]||[],i.push(e),n[e.n]=i,t._listeners=n},s=function(t,e,n,r,s){var o="any"===s?!1:[],u=i(e,n,r);return s||(s="filter"),_.each(t,function(t){return _.each(t,function(t){var e,n=!(u.fn&&u.fn!==t.fn||u.n&&u.n!==t.n||u.c&&u.c!==t.c);if(n&&u.ns.length&&(e=t.ns,n=!_.any(u.ns,function(t){return e.indexOf(t)})),n){if("filter"===s)o.push(t);else if("any"===s)return o=!0,!1}else"invert"===s&&o.push(t)}),o===!0?!1:void 0}),o},o=function(t,e,n,o){var u,c,a;if(t._listeners){if(!e&&!n&&!o)return delete t._listeners,void 0;if(u=i(e,n,o),!u.ns.length&&!n&&!o)return delete t._listeners[u.n],void 0;for(c=s(t._listeners,e,n,o,"invert"),delete t._listeners,a=c.length-1;a>=0;a--)r(t,c[a])}},u=Class.extend({on:function(t,n,s,o){var u,c=this;if(_.isObject(t))return u=n||c,_.each(t,function(t,e){c.on(e,t,u,o)}),this;if("function"!=typeof n)throw TypeError("function expected");return s||(s=this),_.each(t.split(e),function(t){r(c,i(t,n,s,o))}),c},off:function(t,n,i){var r=this;return t?(_.each(t.split(e),function(t){o(r,t,n,i)}),r):(o(r,"",n,i),r)},fire:function(t){if(!this._listeners)return this;var n,i=_.rest(arguments,1),r="string"==typeof t?t.split(e):[t],o=this;return _.each(r,function(t){n="string"==typeof t?t:t.type,_.each(s(o._listeners,n,!1,!1),function(t){t.s&&o.off(0,t.fn),t.fn.apply(t.c,i)})}),o},one:function(t,e,n){return this.on(t,e,n,!0)},hasListener:function(t){return this._listeners?s(this._listeners,t,!1,!1,"any"):!1}});u.prototype.trigger=u.prototype.fire,t.Events=u}(this),function(t){"use strict";var e={},n=Events.extend({constructor:function(t){t=t||{},this.attributes=_.extend({},this.defaults,this.parse(t)),this._changed={},this.id=this.attributes[this.idAttribute],this.cid=_.uniqueId("c"),this.mapping&&this.id&&(e[this.mapping]=e[this.mapping]||{},e[this.mapping][this.id]=this),this.initialize()},initialize:function(){return this},idAttribute:"id",mapping:!1,defaults:{},toJSON:function(){return _.clone(this.attributes)},parse:function(t){return t},baseURL:"/",url:function(){return this.baseURL+(this.mapping?this.mapping+"/":"")+(this.id?this.id+"/":"")},update:function(t){return this.prop(this.parse(t)),this._changed={},this},prop:function(t,e){if(1===arguments.length&&"string"==typeof t)return this.attributes[t];var n={},i=this,r={};return"string"==typeof t?n[t]=e:n=t,_.each(n,function(t,e){r[e]=i._changed[e]=i.attributes[e]=t,e===i.idAttribute&&(i.id=t),i.fire("change:"+e)}),this.fire("change",r),this},get:function(){return this.prop.apply(this,arguments)},set:function(){return this.prop.apply(this,arguments)},validate:function(){return!0},fetch:function(t){t=t||{};var e=this,i={success:function(n){e.update(n),"function"==typeof t.success&&t.success.apply(e,arguments)},error:function(){"function"==typeof t.error&&t.error.apply(e,arguments)}};return n.sync("read",this.url(),_.extend({},t,i)),this},save:function(){var t=this;if(!this.validate())throw Error("Model is invalid");if(this.id){if(0===_.keys(t._changed).length)return this;n.sync("update",this.url(),{data:t._changed,success:function(e){t.update(e)}})}else n.sync("create",this.url(),{data:_.clone(this.attributes),success:function(e){t.update(e)}});return this},remove:function(){this.fire("remove"),this.id&&n.sync("delete",this.url(),{})}});n.fromStorage=function(t,n){return e[t]=e[t]||{},e[t][n]},n.createOrUpdate=function(t,e){var i,r,s,o=t.prototype;return o.mapping&&(r=o.idAttribute,s=o.parse(e),i=n.fromStorage(o.mapping,s[r]))?(i.update(e),i):new t(e)},n.sync=function(t,e,n){n=n||{};var i={method:t};"PUT"===t&&(t="POST"),$.extend(i,n.data),$.ajax({url:e,dataType:"json",type:t,data:i,success:n.success,error:n.error})},t.Model=n}(this),function(){var t=function(t){this.self=t},e=Model.extend({constructor:function(e,n){this.itself=new t(this),this.models=[],this.length=0,this._hashId=[],e&&this.reset(e),this.initialize(n)},models:[],model:Model,url:function(){return this.baseURL+this.model.prototype.mapping+"/"},fetch:function(t){var e=this;t||(t={});var n={success:function(n){e.reset(n,t),"function"==typeof t.success&&t.success.apply(e,arguments)},error:function(){"function"==typeof t.error&&t.error.apply(e,arguments)}},i=_.extend({},t,n);Model.sync("GET",this.url(),i)},reset:function(t,e){if(e||(e={}),e.add||(this.fire("beforeReset",this.models),this.models=[],this.length=0,this._hashId=[]),!t)return this.fire("reset"),this;var n=this.parse(t);return this.add(n,"end",!e.add),e.add||this.fire("reset"),this},push:function(t){return this.add(t)},unshift:function(t){return this.add(t,0)},add:function(t,e,n){function i(t,e){if(0===e&&s.length)r=s._hashId[0].index-1,s._hashId.unshift({id:t.id,index:r});else{var n=s._hashId.length;r=0===n?1:s._hashId[n-1].index+1,s._hashId.push({id:t.id,index:r})}}var r,s=this,o=[];if(t instanceof Array||(t=[t]),"number"!=typeof e)e=this.length;else if(0===e)var u=t.reverse();return _.each(t,function(t,n){t instanceof Model||(t=Model.createOrUpdate(s.model,t)),o.push(t),u?i(u[n],0):i(t,e+n),t.one("remove",function(){s.cutByCid(this.cid)}),s.models.splice(e+n,0,t)}),this.length=this.models.length,n||this.fire("add",o,e),this},cut:function(t){var e;return this.each(function(n,i){return n.id==t?(e=this.cutAt(i),!1):void 0}),e},cutByCid:function(t){var e,n=this;return this.each(function(i,r){return i.cid==t?(e=n.cutAt(r),!1):void 0}),e},shift:function(){return this.cutAt(0)},pop:function(){return this.cutAt()},cutAt:function(t){void 0!==t||(t=this.models.length-1);var e=this.models.splice(t,1)[0];this._hashId.splice(t,1),this.length=this.models.length;var n={};return n[t]=e,this.fire("cut",n),e},at:function(t){return this.models[t]},get:function(){return this.getByID.apply(this,arguments)},getByID:function(t){var e;return this.each(function(n){return n.id==t?(e=n,!1):void 0}),e},getByCid:function(t){var e;return this.each(function(n){return n.cid==t?(e=n,!1):void 0}),e},getIndex:function(t){var e=this.indexOf(t);return this._hashId[e].index}}),n=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortByDesc","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"],i=function(t){return _.isFunction(t)?t:function(e){return e[t]}};_.sortByDesc=function(t,e,n){var r=i(e);return _.pluck(_.map(t,function(t,e,i){return{value:t,index:e,criteria:r.call(n,t,e,i)}}).sort(function(t,e){var n=t.criteria,i=e.criteria;if(n!==i){if(n>i||void 0===n)return-1;if(i>n||void 0===i)return 1}return t.index<e.index?-1:1}),"value")},_.each(n,function(t){e.prototype[t]=function(){return _[t].apply(_,[this.models].concat(_.toArray(arguments)))}});var r=["filter","reject"],s=["sortBy","sortByDesc","shuffle"];_.each(r,function(e){t.prototype[e]=function(){var t="filter"==e?"reject":"filter",n=this.self,i=_.toArray(arguments),r=_[e].apply(_,[n.models].concat(i)),s=_[t].apply(_,[n.models].concat(i)),o={};return _.each(s,function(t){o[n.indexOf(t)]=t}),n.models=r,n.length=r.length,n.fire("cut",o),n}}),_.each(s,function(e){t.prototype[e]=function(){var t=this.self,n=_[e].apply(_,[t.models].concat(_.toArray(arguments))),i={};return _.each(n,function(e,n){i[t.indexOf(e)]=n}),t.models=n,t.length=n.length,t.fire("sort",i),t}}),this.Collection=e}(),function(t){"use strict";var e=t.$,n=/\s+/,i=/\s*;\s*/,r=/^[a-z]+$/,s=/^\s*([^:]+)\s*:\s*([\s\S]*\S)\s*$/,o=/^\{([\s\S]*)\}$/,u=/\s*,\s*/,c={setElement:function(t){return this.undelegateEvents(),this.el=t,this.$el=e(t),this.parse().delegateEvents(),this},constructor:function(t){t=t||{},this.options=t,t.collection&&(this.collection=t.collection),this.model=t.model,t.el&&(this.el=t.el);var n=this;n._cid||(n._cid=_.uniqueId("vm")),n.el||(n.el="div"),"string"==typeof n.el&&(n.el=r.test(n.el)&&"html"!==n.el&&"body"!==n.el?document.createElement(n.el):e(n.el)[0]),n.$el=e(n.el),n.$=function(t){return n.$el.find(t)},n.initialize(),n.autoParseBinds&&n.parse(),n.delegateEvents()},remove:function(){return this.$el.remove(),this},parse:function(){return c.findBinds(this.el,this),this},bindToModel:function(t){var e=Observable(new Model(t)),n=e(),i={},r=this;return e.callAndSubscribe(function(t){n&&n.off(0,0,i),n=t,t&&t.on("change",function(t){_.each(t,function(t,e){r[e].fire()})},i)}),this._bindedToModel||_.each(n.attributes,function(t,n){r[n]=Computed(function(){var t=e();return t?t.prop(n):""})}),this._bindedToModel=!0,e},autoParseBinds:!1,initialize:function(){},delegateEvents:function(t){t=t||this.events,this.undelegateEvents();var e,i,r=this;return _.each(t,function(t,s){var o,u="function"==typeof t?t:r[t];if("function"!=typeof u)throw TypeError(t+" is not a function");e=s.split(n),i=e.shift().split(",").join("."+r._cid+" ")+"."+r._cid,o=_.bind(u,r),e.length?r.$el.delegate(e.join(" "),i,o):r.$el.bind(i,o)}),this},undelegateEvents:function(){return this.$el.unbind("."+this._cid),this},render:function(){return this}};c=Events.extend(c),c.compAsync=!0,c.findObservable=function(t,e,n){n=n||{},Observable.isObservable(t)&&(t=t());var i,r,s,o,u=[],c=[];return _.each(n,function(t,e){u.push(t),c.push(e)}),u.push("with(this) return "+e),i=Function.apply(t,u),s=function(){try{return i.apply(t,c)}catch(n){console.log('Error "'+n.message+'" in expression "'+e+'" Context: ',t)}},o=s(),r=this.compAsync&&o&&!o.async?Observable.isObservable(o)?Computed(function(){return o()},t,!0):Computed(function(){return s()},t,!0):Observable.isObservable(o)?o:Computed(function(){return s()},t)},c.findBinds=function(t,n,r){var o,a,f,h,l,d,p,v,b,m,g,_,y,O=!1,x=this,w=e(t);if(o=w.attr("data-bind"),w.removeAttr("data-bind"),o)for(a=o.split(i),f=0,p=a.length;p>f;f++)for(v=a[f],y=v.match(s),y?(m=y[1],g=y[2]):(m=v,g=""),m=m.split(u),h=0,l=m.length;l>h;h++)b=m[h],b&&"!"!==b.charAt(0)&&(_=c.binds[b],_?(d=_.call(x,t,g,n,r),d===!1?O=!0:d&&(n=d)):console.warn('Bind: "'+b+'" not exists'));O||w.children().each(function(){x.findBinds(this,n,r)})},c.parseOptionsObject=function(t){var e,n,i;if(!t)return{};if(e=t.match(o),!e||void 0===e[1])throw Error('Expression: "'+t+'" is not valid object');return n=e[1].split(u),n.length?(i={},_.each(n,function(n){if(n){if(e=n.match(s),!e||!e[1]||!e[2])throw Error('Expression: "'+t+'" is not valid object');i[e[1]]=e[2]}}),i):{}},t.ViewModel=c}(this),function(){ViewModel.binds={log:function(t,e,n,i){this.findObservable(n,e,i).callAndSubscribe(function(){console.log(n,".",e,"=",this())})},src:function(t,e,n,i){this.findObservable(n,e,i).callAndSubscribe(function(e){t.src=e?e:""})},html:function(t,e,n,i){this.findObservable(n,e,i).callAndSubscribe(function(e){t.innerHTML=e})},text:function(t,e,n,i){var r=$(t);this.findObservable(n,e,i).callAndSubscribe(function(t){r.text(t)})},"with":function(t,e,n,i){return this.findObservable(n,e,i)()},each:function(t,e,n,i){var r=this.findObservable(n,e,i),s=$(t),o=s.html();return s.empty(),i=i?_.clone(i):{},r.callAndSubscribe(function(t){s.empty(),t&&_.each(t,function(e,n){i.$index=n,i.$parent=t,i.$value=e;var r=document.createElement("div");r.innerHTML=o,ViewModel.findBinds(r,e,i),s.append(r.innerHTML)})}),!1},eachModel:function(t,e,n,i){var r=this.findObservable(n,e,i),s=$(t).html(),o=function(e){var n=0;i||(i={});var r=function(r,o){var u=document.createElement("div");$(u).html(s);var c=Observable(r);i.$index=o,i.$parent=e,ViewModel.findBinds(u,c,i);var a=$(u).children();0==o?a.prependTo(t):a.length&&$(t).children().eq(o*a.length).length?a.insertBefore($(t).children().eq(o*a.length)):a.appendTo(t);var f={};r.on("change",function(){c.fire()},f).on("cut",function(t){t===e&&(a.empty().remove(),e.fire("cut",r)),r.off(0,0,f),c.destroy(),delete c},f),n++};e.length&&e.each(r),e.on("add",r),$(t).show()},u=function(){$(t).hide(),$(t).empty();var e=r();e&&o(e)};return u(),r.subscribe(u),!1},value:function(t,e,n,i){var r=$(t),s=ViewModel.findObservable(n,e,i);s.callAndSubscribe(function(t){r.val(t)}),r.change(function(){s(r.val())})},attr:function(t,e,n,i){_.each(this.parseOptionsObject(e),function(e,r){ViewModel.findObservable(n,e,i).callAndSubscribe(function(e){e?t.setAttribute(r,e):t.removeAttribute(r)})})},style:function(t,e,n,i){var r=$(t);_.each(this.parseOptionsObject(e),function(t,e){ViewModel.findObservable(n,t,i).callAndSubscribe(function(t){r.css(e,t)})})},css:function(t,e,n,i){var r=$(t);_.each(this.parseOptionsObject(e),function(t,e){ViewModel.findObservable(n,t,i).callAndSubscribe(function(t){t?r.addClass(e):r.removeClass(e)})})},display:function(t,e,n,i){var r=$(t);this.findObservable(n,e,i).callAndSubscribe(function(t){t?r.show():r.hide()})},click:function(t,e,n,i){var r=this.findObservable(n,e,i)(),s=$(t);s.click(function(){r.apply(n,arguments)})}}}(),function(){var t={},e={};ViewModel.tmpl={getRawTemplate:function(e){return t[e]},getTemplate:function(t){return e[t]},create:function(t,n,i,r,s){var o=document.createElement(s||"div");r=r||{},o.innerHTML=n,i();var u={};return i.subscribe(function(){_.each(u,function(t,e){t(this()[e])})}),_.each(i(),function(t,e){u[e]=Observable(t)}),ViewModel.findBinds(o,u,r),e[t]=function(t,e){return i(t),_.each(e,function(t,e){r[e]&&Observable.isObservable(r[e])&&r[e](t)}),o.innerHTML},e[t].childrenLength=$(o).children().length,e[t]}},ViewModel.binds.template=function(e,n,i,r){var s=$(e),o=n.split(/\s*,\s*/),u=s.html();if(t[o[0]]=u,o[1]){var c=this.findObservable(i,o[1],r);this.tmpl.create(o[0],u,c,r,e.tagName.toLowerCase())}return s.remove(),!1}}();