/*! frontbone 2013-03-06 */
(function(){var t=[],e=!1,n=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(t){setTimeout(function(){t()},1e3/15)};window.ComputedRefresher={refreshAll:function(){_.each(t,function(t){t.refresh()}),t=[]},startRefresh:function(){var t=this;e=!0,n(function(){e&&(t.refreshAll(),t.startRefresh())})},stopRefresh:function(){e=!1}},ComputedRefresher.startRefresh();var i=function(t){return t._listeners=[],t.subscribe=function(){t._listeners.push(arguments)},t.unsubscribe=function(e){for(var n=0,i=t._listeners.length;i>n;n++)t._listeners[n][0]===e&&t._listeners.splice(n,1)},t.fire=function(){for(var e=0,n=t._listeners.length;n>e;e++)t._listeners[e][0].call(t._listeners[e][1]||t,t())},t.callAndSubscribe=function(e){e.call(this,t()),this.subscribe(e)},t._notSimple=!0,t},r=!1,s=function(t){var e=t,n=function(t){return arguments.length>0?(e!==t||_.isObject(t))&&(n.lastValue=e,e=t,n.fire()):r&&r.subscribeTo(n),e};return i(n),n.lastValue=void 0,n.valueOf=n.toString=function(){return this()},n.__observable=!0,n};s.isObservable=function(t){return"function"!=typeof t?!1:t.__observable||!1};var o=function(e){var n,s,o,u;"function"==typeof e?(n=e,s=arguments[1],o=arguments[2],u=arguments[3]):(n=e.get,s=e.context,o=e.async,u=e.set);var c=function(){if(1==arguments.length){if(!u)throw Error("Setter for computed is not defined");u.call(s,arguments[0])}return n.call(s)},a=function(){o?t.push(c):c.refresh()};c.async=o||!1;var f=[];c.subscribeTo=function(t){~f.indexOf(t)||(f.push(t),t.subscribe(a))},i(c),c.__observable=!0,c.valueOf=c.toString=function(){return this()},r=c;var h=n.call(s);return r=!1,c.refresh=function(){var t=this();(h!==t||_.isObject(t))&&this.fire(),h=t},delete f,delete c.subscribeTo,c};this.Observable=s,this.Computed=o,this.Subscribeable=i})(),function(){var t=function(){},e=function(){},n=/xyz/.test(function(){})?/\b_super\b/:/.*/;e.prototype._constructor=Object,e.prototype.constructor=e,e.extend=function(e){var i=this,r=function(){this._constructor.apply(this,arguments)};return e.hasOwnProperty("constructor")&&(e._constructor=e.constructor),t.prototype=i.prototype,r.prototype=new t,_.each(e,function(t,e){r.prototype[e]="function"==typeof t&&t.prototype._constructor===void 0&&void 0===t._notSimple&&n.test(""+t)?function(t,e){return function(){var n=this._super;this._super=i.prototype[t];var r=e.apply(this,arguments);return this._super=n,r}}(e,t):t}),r.prototype.constructor=r,r.extend=i.extend,r.create=i.create,r},e.create=function(t){var e=_.toArray(arguments);e.shift();var n=this.extend(t),i="return new child(",r=e.length,s=["child"],o=[n];if(r>0){for(var u=0;r>u;u++)i+="arg"+u+", ",s.push("arg"+u),o.push(e[u]);i=i.substr(0,i.length-2)}i+=");",s.push(i);var c;try{c=Function.apply(void 0,s).apply(void 0,o)}catch(a){throw a}return c},this.Class=e}(),function(){function t(t){var e=(""+t).split(o);return{n:e[0],ns:e.slice(1),o:t}}function e(t,e){for(var n=t.length-1;n>=0;n--)if(!~e.indexOf(t[n]))return!1;return!0}function n(t,n){return t.n&&t.n!=n.n?!1:t.fn&&t.fn!==n.fn?!1:t.c&&t.c!==n.c?!1:t.ns.length&&!e(t.ns,n.ns)?!1:!0}function i(e,n,i,r){var s=t(e);return s.fn=n,s.c=i,s.s=r,s}function r(t,e){var n,i;n=t._listeners||{},i=n[e.n]||[],i.push(e),n[e.n]=i,t._listeners=n}var s=/\s+/,o=".";Array.prototype.indexOf||(Array.prototype.indexOf=function(t,e){return _.indexOf(this,t,e)});var u=function(t,e,r,s,o){var u,c,a=[],f=i(e,r,s);o||(o="filter");for(u in t)for(c=t[u].length-1;c>=0;c--)if(n(f,t[u][c])){if("filter"==o)a.push(t[u][c]);else if("any"==o)return!0}else"invert"==o&&a.push(t[u][c]);return"any"!=o?a:!1},c=function(t,e,n){var s,o,c;if(this._listeners){if(!t&&!e&&!n)return delete this._listeners,void 0;if(s=i(t,e,n),!s.ns.length&&!e&&!n)return delete this._listeners[s.n],void 0;for(o=u(this._listeners,t,e,n,"invert"),delete this._listeners,c=o.length-1;c>=0;c--)r(this,o[c])}},a=Class.extend({on:function(t,e,n){if(_.isObject(t)){var o=e||this,u=this;return _.each(t,function(t,e){u.on(e,t,o)}),this}var c,a,f=t.split(s);if("function"!=typeof e)throw TypeError("function expected");for(n||(n=this),c=f.length-1;c>=0;c--)a=i(f[c],e,n),r(this,a);return this},off:function(t,e,n){if(!t)return c.call(this,"",e,n),this;var i,r,o=t.split(s);for(i=0,r=o.length;r>i;i++)c.call(this,o[i],e,n);return this},fire:function(t){if(!this._listeners)return this;var e,n,i,r,o,c,a,f=Array.prototype.slice.call(arguments,1);for(e="string"==typeof t?t.split(s):[t],n=0,r=e.length;r>n;n++)for(a="string"==typeof e[n]?e[n]:e[n].type,o=u(this._listeners,a,!1,!1),i=o.length-1;i>=0;i--)c=o[i],c.s&&this.off(void 0,c.fn),c.fn.apply(c.c,f);return this},one:function(t,e,n){var o,u,c=t.split(s);if("function"!=typeof e)throw TypeError("function expected");for(n||(n=this),o=c.length-1;o>=0;o--)u=i(c[o],e,n,!0),r(this,u);return this},hasListener:function(t){return this._listeners?u(this._listeners,t,!1,!1,"any"):!1}});a.prototype.trigger=a.prototype.fire,this.Events=a}(),function(){var t={},e=Events.extend({constructor:function(e){e||(e={}),this.attributes=_.extend({},this.defaults,this.parse(e)),this._changed={},this.id=this.attributes[this.idAttribute],this.cid=_.uniqueId("c"),this.mapping&&this.id&&(t[this.mapping]||(t[this.mapping]={}),t[this.mapping][this.id]=this),this.initialize()},initialize:function(){return this},idAttribute:"id",mapping:!1,defaults:{},toJSON:function(){return _.clone(this.attributes)},parse:function(t){return t},baseURL:"/",url:function(){var t=this.mapping?this.mapping+"/":"",e=this.id?this.id+"/":"";return this.baseURL+t+e},update:function(t){return this.prop(this.parse(t)),this._changed={},this},prop:function(t){if(1==arguments.length&&"string"==typeof t)return this.attributes[t];var e={};"string"==typeof t?e[t]=arguments[1]:e=t;var n=this;return _.each(e,function(t,e){n._changed[e]=n.attributes[e]=t,e==n.idAttribute&&(n.id=t),n.fire("change:"+e)}),this.fire("change"),this},get:function(){return this.prop.apply(this,arguments)},set:function(){return this.prop.apply(this,arguments)},validate:function(){return!0},fetch:function(t){var n=this;t||(t={});var i={success:function(e){n.update(e),"function"==typeof t.success&&t.success.apply(n,arguments)},error:function(){"function"==typeof t.error&&t.error.apply(n,arguments)}},r=_.extend({},t,i);return e.sync("read",this.url(),r),this},save:function(){var t=this;if(!this.validate())throw Error("Model is invalid");if(this.id){if(0==_.keys(t._changed).length)return this;e.sync("update",this.url(),{data:t._changed,success:function(e){t.update(e)}})}else e.sync("create",this.url(),{data:_.clone(this.attributes),success:function(e){t.update(e)}});return this},remove:function(){this.fire("remove"),this.id&&e.sync("delete",this.url(),{})}});e.fromStorage=function(e,n){return t[e]||(t[e]={}),t[e][n]},e.createOrUpdate=function(t,n){var i,r,s,o=t.prototype;return o.mapping&&(r=o.idAttribute,s=o.parse(n),i=e.fromStorage(o.mapping,s[r]))?(i.update(n),i):new t(n)},e.sync=function(t,e,n){n||(n={});var i={method:t};"PUT"==t&&(t="POST"),$.extend(i,n.data),$.ajax({url:e,dataType:"json",type:t,data:i,success:n.success,error:n.error})},this.Model=e}(),function(){var t=function(t){this.self=t},e=Model.extend({constructor:function(e,n){this.itself=new t(this),this.models=[],this.length=0,this._hashId=[],e&&this.reset(e),this.initialize(n)},models:[],model:Model,url:function(){return this.baseURL+this.model.prototype.mapping+"/"},fetch:function(t){var e=this;t||(t={});var n={success:function(n){e.reset(n,t),"function"==typeof t.success&&t.success.apply(e,arguments)},error:function(){"function"==typeof t.error&&t.error.apply(e,arguments)}},i=_.extend({},t,n);Model.sync("GET",this.url(),i)},reset:function(t,e){if(e||(e={}),e.add||(this.models=[],this.length=0,this._hashId=[]),!t)return this.fire("reset"),this;var n=this.parse(t);return this.add(n,"end",!e.add),e.add||this.fire("reset"),this},push:function(t){return this.add(t)},unshift:function(t){return this.add(t,0)},add:function(t,e,n){function i(t,e){if(0===e&&s.length)r=s._hashId[0].index-1,s._hashId.unshift({id:t.id,index:r});else{var n=s._hashId.length;r=0===n?1:s._hashId[n-1].index+1,s._hashId.push({id:t.id,index:r})}}var r,s=this,o=[];if(t instanceof Array||(t=[t]),"number"!=typeof e)e=this.length;else if(0===e)var u=t.reverse();return _.each(t,function(t,n){t instanceof Model||(t=Model.createOrUpdate(s.model,t)),o.push(t),u?i(u[n],0):i(t,e+n),t.one("remove",function(){s.cutByCid(this.cid)}),s.models.splice(e+n,0,t)}),this.length=this.models.length,n||this.fire("add",o,e),this},cut:function(t){var e;return this.each(function(n,i){return n.id==t?(e=this.cutAt(i),!1):void 0}),e},cutByCid:function(t){var e,n=this;return this.each(function(i,r){return i.cid==t?(e=n.cutAt(r),!1):void 0}),e},shift:function(){return this.cutAt(0)},pop:function(){return this.cutAt()},cutAt:function(t){void 0!==t||(t=this.models.length-1);var e=this.models.splice(t,1)[0];return this._hashId.splice(t,1),this.length=this.models.length,this.fire("cut",e,t),e},at:function(t){return this.models[t]},get:function(){return this.getByID.apply(this,arguments)},getByID:function(t){var e;return this.each(function(n){return n.id==t?(e=n,!1):void 0}),e},getByCid:function(t){var e;return this.each(function(n){return n.cid==t?(e=n,!1):void 0}),e},getIndex:function(t){var e=this.indexOf(t);return this._hashId[e].index}}),n=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortByDesc","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"],i=function(t){return _.isFunction(t)?t:function(e){return e[t]}};_.sortByDesc=function(t,e,n){var r=i(e);return _.pluck(_.map(t,function(t,e,i){return{value:t,index:e,criteria:r.call(n,t,e,i)}}).sort(function(t,e){var n=t.criteria,i=e.criteria;if(n!==i){if(n>i||void 0===n)return-1;if(i>n||void 0===i)return 1}return t.index<e.index?-1:1}),"value")},_.each(n,function(t){e.prototype[t]=function(){return _[t].apply(_,[this.models].concat(_.toArray(arguments)))}});var r=["filter","reject"],s=["sortBy","sortByDesc","shuffle"];_.each(r,function(e){t.prototype[e]=function(){var t="filter"==e?"reject":"filter",n=this.self,i=_[e].apply(_,[n.models].concat(_.toArray(arguments))),r=_[t].apply(_,[n.models].concat(_.toArray(arguments))),s={};return _.each(r,function(t){s[n.indexOf(t)]=t}),n.models=i,n.length=i.length,n.fire("reject",s),n}}),_.each(s,function(e){t.prototype[e]=function(){var t=this.self,n=_[e].apply(_,[t.models].concat(_.toArray(arguments))),i={};return _.each(n,function(e,n){i[t.indexOf(e)]=n}),t.models=n,t.length=n.length,t.fire("sort",i),t}}),this.Collection=e}(),function(){"use strict";var t=this.$,e=/\s+/,n=/\s*;\s*/,i=/^[a-z]+$/,r=/^\s*([^:]+)\s*:\s*([\s\S]*\S)\s*$/,s=/^{([\s\S]*)}$/,o=/\s*,\s*/,u={setElement:function(e){return this.undelegateEvents(),this.el=e,this.$el=t(e),this.parse().delegateEvents(),this},constructor:function(e){e||(e={}),this.options=e,e.collection&&(this.collection=e.collection),this.model=e.model,e.el&&(this.el=e.el);var n=this;n._cid||(n._cid=_.uniqueId("vm")),n.el||(n.el="div"),"string"==typeof n.el&&(n.el=i.test(n.el)&&"html"!=n.el&&"body"!=n.el?document.createElement(n.el):t(n.el)[0]),n.$el=t(n.el),n.$=function(t){return n.$el.find(t)},n.initialize(),n.autoParseBinds&&n.parse(),n.delegateEvents()},remove:function(){return this.$el.remove(),this},parse:function(){return u.findBinds(this.el,this),this},bindToModel:function(t){var e=Observable(new Model(t)),n=e(),i=!0,r={},s=function(t){n&&n.off(0,0,r),n=t,t&&t.on("change",function(){i=!1,e.fire(),i=!0},r)};if(s(n),e.subscribe(function(){i&&s(this())}),!this._bindedToModel)for(var o in n.attributes)this[o]=function(t,n){return Computed(function(){var n=e();return n?n.prop(t):""},n)}(o,this);return this._bindedToModel=!0,e},autoParseBinds:!1,initialize:function(){},delegateEvents:function(t){t||(t=this.events),this.undelegateEvents();var n,i,r,s,o,u=this;for(r in t){if(n=t[r],i="function"==typeof n?n:u[n]||Function("return "+n)(),"function"!=typeof i)throw TypeError(n+" is not a function");s=r.split(e),o=s.shift().split(",").join("."+u._cid+" ")+"."+u._cid;var c=function(t){return function(){t.apply(u,arguments)}}(i);s.length?u.$el.delegate(s.join(" "),o,c):u.$el.bind(o,c)}return this},undelegateEvents:function(){return this.$el.unbind("."+this._cid),this},render:function(){return this}};u=Events.extend(u),u.compAsync=!0,u.findObservable=function(t,e,n){n||(n={}),Observable.isObservable(t)&&(t=t());for(var i=_.keys(n),r=[],s=0,o=i.length;o>s;s++)r[s]=n[i[s]];i.push("with(this) return "+e);var u,c=Function.apply(t,i),a=function(){try{return c.apply(t,r)}catch(n){console.log('Error "'+n.message+'" in expression "'+e+'" Context: ',t)}},f=a();return u=this.compAsync&&f&&!f.async?Observable.isObservable(f)?Computed(function(){return f()},t,!0):Computed(function(){return a()},t,!0):Observable.isObservable(f)?f:Computed(function(){return a()},t)},u.findBinds=function(e,i,s){var o,c,a,f,h,l,d,p,v,b=t(e);if(c=b.attr("data-bind"),b.removeAttr("data-bind"),c)for(a=c.split(n),f=0,l=a.length;l>f;f++)if(d=a[f],d&&"!"!=d.charAt(0)){var m=d.match(r);m?(p=m[1],v=m[2]):(p=d,v="");var g=u.binds[p];if(g){if(h=g.call(this,e,v,i,s),h===!1)return;h&&(i=h)}else console.warn('Bind: "'+p+'" not exists')}if(e)for(o=b.children(),f=0,l=o.length;l>f;f++)this.findBinds(o[f],i,s)},u.parseOptionsObject=function(t){var e=t;if(!e)return{};var n=e.match(s);if(!n||void 0===n[1])throw Error('Expression: "'+t+'" is not valid object');e=n[1];var i=e.split(o);if(!i.length)return{};var u={};return _.each(i,function(e){if(e){if(n=e.match(r),!n||!n[1]||!n[2])throw Error('Expression: "'+t+'" is not valid object');u[n[1]]=n[2]}}),u},this.ViewModel=u}.apply(this),function(){ViewModel.binds={log:function(t,e,n,i){this.findObservable(n,e,i).callAndSubscribe(function(){console.log(n,".",e,"=",this())})},src:function(t,e,n,i){this.findObservable(n,e,i).callAndSubscribe(function(e){e&&(t.src=e)})},html:function(t,e,n,i){this.findObservable(n,e,i).callAndSubscribe(function(e){t.innerHTML=e})},text:function(t,e,n,i){var r=$(t);this.findObservable(n,e,i).callAndSubscribe(function(t){r.text(t)})},"with":function(t,e,n,i){return this.findObservable(n,e,i)()},each:function(t,e,n,i){var r=this.findObservable(n,e,i),s=$(t),o=s.html();return s.empty(),i=i?_.clone(i):{},r.callAndSubscribe(function(t){s.empty(),t&&_.each(t,function(e,n){i.$index=n,i.$parent=t,i.$value=e;var r=document.createElement("div");r.innerHTML=o,ViewModel.findBinds(r,e,i),s.append(r.innerHTML)})}),!1},eachModel:function(t,e,n,i){var r=this.findObservable(n,e,i),s=$(t).html(),o=function(e){var n=0;i||(i={});var r=function(r,o){var u=document.createElement("div");$(u).html(s);var c=Observable(r);i.$index=o,i.$parent=e,ViewModel.findBinds(u,c,i);var a=$(u).children();0==o?a.prependTo(t):a.length&&$(t).children().eq(o*a.length).length?a.insertBefore($(t).children().eq(o*a.length)):a.appendTo(t);var f={};r.on("change",function(){c.fire()},f).on("cut",function(t){t===e&&(a.empty().remove(),e.fire("cut",r)),r.off(0,0,f),c.destroy(),delete c},f),n++};e.length&&e.each(r),e.on("add",r),$(t).show()},u=function(){$(t).hide(),$(t).empty();var e=r();e&&o(e)};return u(),r.subscribe(u),!1},value:function(t,e,n,i){var r=$(t),s=ViewModel.findObservable(n,e,i);s.callAndSubscribe(function(t){r.val(t)}),r.change(function(){s(r.val())})},attr:function(t,e,n,i){_.each(this.parseOptionsObject(e),function(e,r){ViewModel.findObservable(n,e,i).callAndSubscribe(function(e){e?t.setAttribute(r,e):t.removeAttribute(r)})})},style:function(t,e,n,i){var r=$(t);_.each(this.parseOptionsObject(e),function(t,e){ViewModel.findObservable(n,t,i).callAndSubscribe(function(t){r.css(e,t)})})},css:function(t,e,n,i){var r=$(t);_.each(this.parseOptionsObject(e),function(t,e){ViewModel.findObservable(n,t,i).callAndSubscribe(function(t){t?r.addClass(e):r.removeClass(e)})})},display:function(t,e,n,i){var r=$(t);this.findObservable(n,e,i).callAndSubscribe(function(t){t?r.show():r.hide()})},click:function(t,e,n,i){var r=this.findObservable(n,e,i)(),s=$(t);s.click(function(){r.apply(n,arguments)})}}}(),function(){var t={},e={};ViewModel.tmpl={getRawTemplate:function(e){return t[e]},getTemplate:function(t){return e[t]},create:function(t,n,i,r,s){var o=document.createElement(s||"div");r=r||{},o.innerHTML=n,i();var u={};return i.subscribe(function(){_.each(u,function(t,e){t(this()[e])})}),_.each(i(),function(t,e){u[e]=Observable(t)}),ViewModel.findBinds(o,u,r),e[t]=function(t,e){return i(t),_.each(e,function(t,e){r[e]&&Observable.isObservable(r[e])&&r[e](t)}),o.innerHTML},e[t].childrenLength=$(o).children().length,e[t]}},ViewModel.binds.template=function(e,n,i,r){var s=$(e),o=n.split(/\s*,\s*/),u=s.html();if(t[o[0]]=u,o[1]){var c=this.findObservable(i,o[1],r);this.tmpl.create(o[0],u,c,r,e.tagName.toLowerCase())}return s.remove(),!1}}();