/*! frontbone 2013-02-21 */
(function(){var t=function(){},e=function(){},n=/xyz/.test(function(){})?/\b_super\b/:/.*/;e.prototype._constructor=Object,e.prototype.constructor=e,e.extend=function(e){var i=this,r=function(){this._constructor.apply(this,arguments)};return e.hasOwnProperty("constructor")&&(e._constructor=e.constructor),t.prototype=i.prototype,r.prototype=new t,_.each(e,function(t,e){r.prototype[e]="function"==typeof t&&t.prototype._constructor===void 0&&void 0===t._notSimple&&n.test(""+t)?function(t,e){return function(){var n=this._super;this._super=i.prototype[t];var r=e.apply(this,arguments);return this._super=n,r}}(e,t):t}),r.prototype.constructor=r,r.extend=i.extend,r.create=i.create,r},e.create=function(t){var e=_.toArray(arguments);e.shift();var n=this.extend(t),i="return new child(",r=e.length,s=["child"],o=[n];if(r>0){for(var u=0;r>u;u++)i+="arg"+u+", ",s.push("arg"+u),o.push(e[u]);i=i.substr(0,i.length-2)}i+=");",s.push(i);var c;try{c=Function.apply(void 0,s).apply(void 0,o)}catch(a){throw a}return c},this.Class=e})(),function(){function t(t){var e=(""+t).split(o);return{n:e[0],ns:e.slice(1),o:t}}function e(t,e){for(var n=t.length-1;n>=0;n--)if(!~e.indexOf(t[n]))return!1;return!0}function n(t,n){return t.n&&t.n!=n.n?!1:t.fn&&t.fn!==n.fn?!1:t.c&&t.c!==n.c?!1:t.ns.length&&!e(t.ns,n.ns)?!1:!0}function i(e,n,i,r){var s=t(e);return s.fn=n,s.c=i,s.s=r,s}function r(t,e){var n,i;n=t._listeners||{},i=n[e.n]||[],i.push(e),n[e.n]=i,t._listeners=n}var s=/\s+/,o=".";Array.prototype.indexOf||(Array.prototype.indexOf=function(t,e){return _.indexOf(this,t,e)});var u=function(t,e,r,s,o){var u,c,a=[],f=i(e,r,s);o||(o="filter");for(u in t)for(c=t[u].length-1;c>=0;c--)if(n(f,t[u][c])){if("filter"==o)a.push(t[u][c]);else if("any"==o)return!0}else"invert"==o&&a.push(t[u][c]);return"any"!=o?a:!1},c=function(t,e,n){var s,o,c;if(this._listeners){if(!t&&!e&&!n)return delete this._listeners,void 0;if(s=i(t,e,n),!s.ns.length&&!e&&!n)return delete this._listeners[s.n],void 0;for(o=u(this._listeners,t,e,n,"invert"),delete this._listeners,c=o.length-1;c>=0;c--)r(this,o[c])}},a=Class.extend({on:function(t,e,n){var o,u,c=t.split(s);if("function"!=typeof e)throw TypeError("function expected");for(n||(n=this),o=c.length-1;o>=0;o--)u=i(c[o],e,n),r(this,u);return this},off:function(t,e,n){if(!t)return c.call(this,"",e,n),this;var i,r,o=t.split(s);for(i=0,r=o.length;r>i;i++)c.call(this,o[i],e,n);return this},fire:function(t){if(!this._listeners)return this;var e,n,i,r,o,c,a,f=Array.prototype.slice.call(arguments,1);for(e="string"==typeof t?t.split(s):[t],n=0,r=e.length;r>n;n++)for(a="string"==typeof e[n]?e[n]:e[n].type,o=u(this._listeners,a,!1,!1),i=o.length-1;i>=0;i--)c=o[i],c.s&&this.off(void 0,c.fn),c.fn.apply(c.c,f);return this},one:function(t,e,n){var o,u,c=t.split(s);if("function"!=typeof e)throw TypeError("function expected");for(n||(n=this),o=c.length-1;o>=0;o--)u=i(c[o],e,n,!0),r(this,u);return this},hasListener:function(t){return this._listeners?u(this._listeners,t,!1,!1,"any"):!1}});a.prototype.trigger=a.prototype.fire,this.Events=a}(),function(){var t={},e=Events.extend({constructor:function(e){e||(e={}),this.attributes=_.extend({},this.defaults,this.parse(e)),this._changed={},this.id=this.attributes[this.idAttribute],this.cid=_.uniqueId("c"),this.mapping&&this.id&&(t[this.mapping]||(t[this.mapping]={}),t[this.mapping][this.id]=this),this.initialize()},initialize:function(){return this},idAttribute:"id",mapping:!1,defaults:{},toJSON:function(){return _.clone(this.attributes)},parse:function(t){return t},baseURL:"/",url:function(){var t=this.mapping?this.mapping+"/":"",e=this.id?this.id+"/":"";return this.baseURL+t+e},update:function(t){return this.prop(this.parse(t)),this._changed={},this},prop:function(t){if(1==arguments.length&&"string"==typeof t)return this.attributes[t];var e={};"string"==typeof t?e[t]=arguments[1]:e=t;var n=this;return _.each(e,function(t,e){n._changed[e]=n.attributes[e]=t,e==n.idAttribute&&(n.id=t),n.fire("change:"+e)}),this.fire("change"),this},get:function(){return this.prop.apply(this,arguments)},set:function(){return this.prop.apply(this,arguments)},validate:function(){return!0},fetch:function(t){var n=this;t||(t={});var i={success:function(e){n.update(e),"function"==typeof t.success&&t.success.apply(n,arguments)},error:function(){"function"==typeof t.error&&t.error.apply(n,arguments)}},r=_.extend({},t,i);return e.sync("read",this.url(),r),this},save:function(){var t=this;if(!this.validate())throw Error("Model is invalid");if(this.id){if(0==_.keys(t._changed).length)return this;e.sync("update",this.url(),{data:t._changed,success:function(e){t.update(e)}})}else e.sync("create",this.url(),{data:_.clone(this.attributes),success:function(e){t.update(e)}});return this},remove:function(){this.fire("remove"),this.id&&e.sync("delete",this.url(),{})}});e.fromStorage=function(e,n){return t[e]||(t[e]={}),t[e][n]},e.createOrUpdate=function(t,n){var i,r,s,o=t.prototype;return o.mapping&&(r=o.idAttribute,s=o.parse(n),i=e.fromStorage(o.mapping,s[r]))?(i.update(n),i):new t(n)},e.sync=function(t,e,n){n||(n={});var i={method:t};"PUT"==t&&(t="POST"),$.extend(i,n.data),$.ajax({url:e,dataType:"json",type:t,data:i,success:n.success,error:n.error})},this.Model=e}(),function(){var t=function(t){this.self=t},e=Model.extend({constructor:function(e,n){this.itself=new t(this),this.models=[],this.length=0,e&&e.length&&this.reset(e),this.initialize(n)},models:[],model:Model,url:function(){return this.baseURL+this.model.prototype.mapping+"/"},fetch:function(t){var e=this;t||(t={});var n={success:function(n){e.reset(n,t),"function"==typeof t.success&&t.success.apply(e,arguments)},error:function(){"function"==typeof t.error&&t.error.apply(e,arguments)}},i=_.extend({},t,n);Model.sync("GET",this.url(),i)},reset:function(t,e){if(e||(e={}),e.add||(this.models=[],this.length=0),!t)return this.fire("reset"),void 0;var n=this.parse(t);n instanceof Array?(this.add(n,"end",!e.add),e.add||this.fire("reset")):(this.add(n,"end",!e.add),e.add&&this.fire("reset"))},push:function(t){return this.add(t)},unshift:function(t){return this.add(t,0)},add:function(t,e,n){t instanceof Array||(t=[t]),"number"==typeof e||(e=this.length);var i=this,r=[];return _.each(t,function(t,n){t instanceof Model||(t=Model.createOrUpdate(i.model,t)),r.push(t),t.one("remove",function(){i.cutByCid(this.cid)}),i.models.splice(e+n,0,t)}),this.length=this.models.length,n||this.fire("add",r,e),this},cut:function(t){var e;return this.each(function(n,i){return n.id==t?(e=this.cutAt(i),!1):void 0}),e},cutByCid:function(t){var e,n=this;return this.each(function(i,r){return i.cid==t?(e=n.cutAt(r),!1):void 0}),e},shift:function(){return this.cutAt(0)},pop:function(){return this.cutAt()},cutAt:function(t){void 0!==t||(t=this.models.length-1);var e=this.models.splice(t,1)[0];return this.length=this.models.length,this.fire("cut",e,t),e},at:function(t){return this.models[t]},get:function(){return this.getByID.apply(this,arguments)},getByID:function(t){var e;return this.each(function(n){return n.id==t?(e=n,!1):void 0}),e},getByCid:function(t){var e;return this.each(function(n){return n.cid==t?(e=n,!1):void 0}),e}}),n=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortByDesc","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"],i=function(t){return _.isFunction(t)?t:function(e){return e[t]}};_.sortByDesc=function(t,e,n){var r=i(e);return _.pluck(_.map(t,function(t,e,i){return{value:t,index:e,criteria:r.call(n,t,e,i)}}).sort(function(t,e){var n=t.criteria,i=e.criteria;if(n!==i){if(n>i||void 0===n)return-1;if(i>n||void 0===i)return 1}return t.index<e.index?-1:1}),"value")},_.each(n,function(t){e.prototype[t]=function(){return _[t].apply(_,[this.models].concat(_.toArray(arguments)))}});var r=["filter","reject"],s=["sortBy","sortByDesc","shuffle"];_.each(r,function(e){t.prototype[e]=function(){var t="filter"==e?"reject":"filter",n=this.self,i=_[e].apply(_,[n.models].concat(_.toArray(arguments))),r=_[t].apply(_,[n.models].concat(_.toArray(arguments))),s={};return _.each(r,function(t){s[n.indexOf(t)]=t}),n.models=i,n.length=i.length,n.fire("reject",s),n}}),_.each(s,function(e){t.prototype[e]=function(){var t=this.self,n=_[e].apply(_,[t.models].concat(_.toArray(arguments))),i={};return _.each(n,function(e,n){i[t.indexOf(e)]=n}),t.models=n,t.length=n.length,t.fire("sort",i),t}}),this.Collection=e}(),function(){(function(){var t=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(){var t=[],e=!1;return function(n){t.push(n),e||setTimeout(function(){_.each(t,function(t){t()}),t=[],e=!1},1e3/60)}}();window.requestAnimationFrame=t})();var t=function(t){return t._listeners=[],t.subscribe=function(e){t._listeners.push(e)},t.unsubscribe=function(e){for(var n=0,i=t._listeners.length;i>n;n++)t._listeners[n]===e&&t._listeners.splice(n,1)},t.fire=function(){for(var e=0,n=t._listeners.length;n>e;e++)t._listeners[e].call(t)},t._notSimple=!0,t},e=!1,n=function(n){var i=n,r=function(t){return arguments.length>0?(i!==t||_.isObject(t))&&(r.lastValue=i,i=t,r.fire()):e&&e.subscribeTo(r),i};return t(r),r.lastValue=void 0,r.valueOf=r.toString=function(){return this()},r.__observable=!0,r};n.isObservable=function(t){return"function"!=typeof t?!1:t.__observable||!1};var i=function(n){var i,r,s,o;"function"==typeof n?(i=n,r=arguments[1],s=arguments[2],o=arguments[3]):(i=n.get,r=n.context,s=n.async,o=n.set);var u=i.call(r),c=function(){return 1==arguments.length&&o.call(r,arguments[0]),e&&e.subscribeTo(c),u},a=!1;return c.async=s||!1,c.subscribeTo=function(t){t.subscribe(function(){c.refresh(),c.async?a||(a=!0,window.requestAnimationFrame(function(){c.fire(),a=!1})):c.fire()})},t(c),c.refresh=function(){u=i.call(r)},c.__observable=!0,c.valueOf=c.toString=function(){return this()},e=c,i.call(r),e=!1,c};this.Observable=n,this.Computed=i,this.Subscribeable=t}(),function(){var t=this.$,e=/\s+/,n=/\s*;\s*/,i=/^[a-z]+$/,r={setElement:function(e){return this.undelegateEvents(),this.el=e,this.$el=t(e),this.parse().delegateEvents(),this},constructor:function(e){e||(e={}),this.options=e,e.collection&&(this.collection=e.collection),this.model=e.model,e.el&&(this.el=e.el);var n=this;n._cid||(n._cid=_.uniqueId("vm")),n.el||(n.el="div"),"string"==typeof n.el&&(n.el=i.test(n.el)&&"html"!=n.el&&"body"!=n.el?document.createElement(n.el):t(n.el)[0]),n.$el=t(n.el),n.$=function(t){return n.$el.find(t)},n.initialize(),n.autoParseBinds&&n.parse(),n.delegateEvents()},remove:function(){return this.$el.remove(),this},parse:function(){return r.findBinds(this.el,this),this},bindToModel:function(t){var e=Observable(new Model(t)),n=e(),i=!0,r={},s=function(t){n&&n.off(0,0,r),n=t,t&&t.on("change",function(){i=!1,e.fire(),i=!0},r)};if(s(n),e.subscribe(function(){i&&s(this())}),!this._bindedToModel)for(var o in n.attributes)this[o]=function(t,n){return Computed(function(){var n=e();return n?this["format_"+t]?this["format_"+t](n.get(t)):n.get(t):""},n)}(o,this);return this._bindedToModel=!0,e},autoParseBinds:!1,initialize:function(){},delegateEvents:function(t){t||(t=this.events),this.undelegateEvents();var n,i,r,s,o,u=this;for(r in t){if(n=t[r],i="function"==typeof n?n:u[n]||Function("return "+n)(),"function"!=typeof i)throw TypeError(n+" is not a function");s=r.split(e),o=s.shift().split(",").join("."+u._cid+" ")+"."+u._cid;var c=function(t){return function(){t.apply(u,arguments)}}(i);s.length?u.$el.delegate(s.join(" "),o,c):u.$el.bind(o,c)}return this},undelegateEvents:function(){return this.$el.unbind("."+this._cid),this},render:function(){return this}};r=Events.extend(r),r.compAsync=!1,r.findObservable=function(t,e,n){n||(n={}),Observable.isObservable(t)&&(t=t());for(var i=_.keys(n),s=[],o=0;i.length>o;o++)s[o]=n[i[o]];i.push("with(this) return "+e);var u,c=function(){try{return Function.apply(t,i).apply(t,s)}catch(n){console.log('Error "'+n.message+'" in expression "'+e+'" Context: ',t)}},a=c();return u=r.compAsync?Observable.isObservable(a)?Computed(function(){return a()},t,!0):Computed(function(){return c()},t,!0):Observable.isObservable(a)?a:Computed(function(){return c()},t)},r.findBinds=function(e,i,s){var o,u,c,a,f,h,l=t(e);if(u=l.attr("data-bind"),l.removeAttr("data-bind"),u)for(c=u.split(n),a=0,h=c.length;h>a;a++)if(c[a]){var d=c[a].match(/^\s*(\S+)\s*:\s*(\S[\s\S]*\S)\s*$/);d||(d=[c[a],c[a],""]);var p=r.binds[d[1]];if(p){if(f=p.call(this,e,d[2],i,s),f===!1)return;f&&(i=f)}}if(e)for(o=l.children(),a=0,h=o.length;h>a;a++)r.findBinds(o[a],i,s)},this.ViewModel=r}(),function(){ViewModel.binds={log:function(t,e,n,i){var r=this.findObservable(n,e,i);console.log(n,".",e,"=",r())},html:function(t,e,n,i){var r=this.findObservable(n,e,i),s=function(){$(t).html(r())};s(),r.subscribe(s)},text:function(t,e,n,i){var r=this.findObservable(n,e,i),s=function(){$(t).text(r())};s(),r.subscribe(s)},"with":function(t,e,n,i){return this.findObservable(n,e,i)()},each:function(t,e,n,i){var r=this.findObservable(n,e,i),s=$(t),o=s.html();s.hide().empty(),i||(i={});var u=function(){s.hide().empty();var e=r();e&&$.each(e,function(n,r){i.$index=n,i.$parent=e,i.$value=r;var s=document.createElement("div");$(s).html(o),ViewModel.findBinds(s,r,i);var u=$(s).children();u.appendTo(t)}),s.show()};return u(),r.subscribe(u),!1},eachModel:function(t,e,n,i){var r=this.findObservable(n,e,i),s=$(t).html(),o=function(e){var n=0;i||(i={});var r=function(r,o){var u=document.createElement("div");$(u).html(s);var c=Observable(r);i.$index=o,i.$parent=e,ViewModel.findBinds(u,c,i);var a=$(u).children();0==o?a.prependTo(t):a.length&&$(t).children().eq(o*a.length).length?a.insertBefore($(t).children().eq(o*a.length)):a.appendTo(t);var f={};r.on("change",function(){c.fire()},f).on("cut",function(t){t===e&&(a.empty().remove(),e.fire("cut",r)),r.off(0,0,f),c.destroy(),delete c},f),n++};e.length&&e.each(r),e.on("add",r),$(t).show()},u=function(){$(t).hide(),$(t).empty();var e=r();e&&o(e)};return u(),r.subscribe(u),!1},value:function(t,e,n,i){var r=ViewModel.findObservable(n,e,i),s=function(){$(t).val(r())};s(),r.subscribe(s)},attr:function(t,e,n,i){e=e.match(/^{([\s\S]+)}$/)[1];for(var r=e.split(/\s*,\s*/),s=r.length-1;s>=0;s--){var o=r[s].match(/^\s*(\S+?)\s*:\s*(\S[\s\S]*\S)\s*$/),u=ViewModel.findObservable(n,o[2],i);(function(t,e,n){var i=function(){$(t).attr(e,n())};i(),n.subscribe(i)})(t,o[1],u)}},style:function(t,e,n,i){e=e.match(/^{([\s\S]+)}$/)[1];for(var r=e.split(/\s*,\s*/),s=r.length-1;s>=0;s--){var o=r[s].match(/^\s*(\S+?)\s*:\s*(\S[\s\S]*\S)\s*$/),u=ViewModel.findObservable(n,o[2],i);(function(t,e,n){var i=function(){$(t).css(e,n())};i(),n.subscribe(i)})(t,o[1],u)}},css:function(t,e,n,i){e=e.match(/^{([\s\S]+)}$/)[1];for(var r=e.split(/\s*,\s*/),s=r.length-1;s>=0;s--){var o=r[s].match(/^\s*(\S+?)\s*:\s*(\S[\s\S]*\S)\s*$/);(function(e,r){var s=ViewModel.findObservable(n,e,i),o=function(){s()?$(t).addClass(r):$(t).removeClass(r)};o(),s.subscribe(o)})(o[2],o[1])}},display:function(t,e,n,i){var r=this.findObservable(n,e,i),s=$(t),o=function(){r()?s.show():s.hide()};o(),r.subscribe(o)},click:function(t,e,n,i){var r=this.findObservable(n,e,i)(),s=$(t);s.click(function(){r.apply(n,arguments)})}}}();